(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{776:function(n,e,s){"use strict";s.r(e);var a=s(0),t=Object(a.a)({},(function(){var n=this,e=n._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h1",{attrs:{id:"juc集合-concurrentlinkedqueue详解"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#juc集合-concurrentlinkedqueue详解"}},[n._v("#")]),n._v(" JUC集合:ConcurrentLinkedQueue详解")]),n._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[n._v("提示")]),n._v(" "),e("p",[n._v("ConcurerntLinkedQueue一个基于链接节点的无界线程安全队列。此队列按照 FIFO(先进先出)原则对元素进行排序。队列的头部是队列中时间最长的元素。队列的尾部 是队列中时间最短的元素。新的元素插入到队列的尾部，队列获取操作从队列头部获得元素。当多个线程共享访问一个公共 collection 时，ConcurrentLinkedQueue是一个恰当的选择。此队列不允许使用null元素。 @123")])]),n._v(" "),e("ul",[e("li",[n._v("JUC集合: ConcurrentLinkedQueue详解\n"),e("ul",[e("li",[n._v("带着BAT大厂的面试问题去理解")]),n._v(" "),e("li",[n._v("ConcurrentLinkedQueue数据结构")]),n._v(" "),e("li",[n._v("ConcurrentLinkedQueue源码分析\n"),e("ul",[e("li",[n._v("类的继承关系")]),n._v(" "),e("li",[n._v("类的内部类")]),n._v(" "),e("li",[n._v("类的属性")]),n._v(" "),e("li",[n._v("类的构造函数")]),n._v(" "),e("li",[n._v("核心函数分析\n"),e("ul",[e("li",[n._v("offer函数")]),n._v(" "),e("li",[n._v("poll函数")]),n._v(" "),e("li",[n._v("remove函数")]),n._v(" "),e("li",[n._v("size函数")])])])])]),n._v(" "),e("li",[n._v("ConcurrentLinkedQueue示例")]),n._v(" "),e("li",[n._v("再深入理解\n"),e("ul",[e("li",[n._v("HOPS(延迟更新的策略)的设计")]),n._v(" "),e("li",[n._v("ConcurrentLinkedQueue适合的场景")])])]),n._v(" "),e("li",[n._v("参考文章")])])])]),n._v(" "),e("h3",{attrs:{id:"带着bat大厂的面试问题去理解"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#带着bat大厂的面试问题去理解"}},[n._v("#")]),n._v(" # 带着BAT大厂的面试问题去理解")]),n._v(" "),e("blockquote",[e("p",[n._v("提示")])]),n._v(" "),e("blockquote",[e("p",[n._v("请带着这些问题继续后文，会很大程度上帮助你更好的理解相关知识点。@pdai")])]),n._v(" "),e("ul",[e("li",[e("p",[n._v("要想用线程安全的队列有哪些选择? Vector，")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("Collections.synchronizedList(List<T> list)\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br")])]),e("p",[n._v(", ConcurrentLinkedQueue等")])]),n._v(" "),e("li",[e("p",[n._v("ConcurrentLinkedQueue实现的数据结构?")])]),n._v(" "),e("li",[e("p",[n._v("ConcurrentLinkedQueue底层原理? 全程无锁(CAS)")])]),n._v(" "),e("li",[e("p",[n._v("ConcurrentLinkedQueue的核心方法有哪些? offer()，poll()，peek()，isEmpty()等队列常用方法")])]),n._v(" "),e("li",[e("p",[n._v("说说ConcurrentLinkedQueue的HOPS(延迟更新的策略)的设计?")])]),n._v(" "),e("li",[e("p",[n._v("ConcurrentLinkedQueue适合什么样的使用场景?")])])]),n._v(" "),e("h3",{attrs:{id:"concurrentlinkedqueue数据结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#concurrentlinkedqueue数据结构"}},[n._v("#")]),n._v(" # ConcurrentLinkedQueue数据结构")]),n._v(" "),e("blockquote",[e("p",[n._v("通过源码分析可知，ConcurrentLinkedQueue的数据结构与LinkedBlockingQueue的数据结构相同，都是使用的链表结构。ConcurrentLinkedQueue的数据结构如下:")])]),n._v(" "),e("blockquote",[e("p",[n._v("![](./JUC集合_ ConcurrentLinkedQueue详解 _ Java 全栈知识体系_files/java-thread-x-juc-concurrentlinkedqueue-1.png)")])]),n._v(" "),e("blockquote",[e("p",[n._v("说明: ConcurrentLinkedQueue采用的链表结构，并且包含有一个头节点和一个尾结点。")])]),n._v(" "),e("h3",{attrs:{id:"concurrentlinkedqueue源码分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#concurrentlinkedqueue源码分析"}},[n._v("#")]),n._v(" # ConcurrentLinkedQueue源码分析")]),n._v(" "),e("h3",{attrs:{id:"类的继承关系"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#类的继承关系"}},[n._v("#")]),n._v(" # 类的继承关系")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("public class ConcurrentLinkedQueue<E> extends AbstractQueue<E>\n        implements Queue<E>, java.io.Serializable {}\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br")])]),e("blockquote",[e("p",[n._v("说明: ConcurrentLinkedQueue继承了抽象类AbstractQueue，AbstractQueue定义了对队列的基本操作；同时实现了Queue接口，Queue定义了对队列的基本操作，同时，还实现了Serializable接口，表示可以被序列化。")])]),n._v(" "),e("h3",{attrs:{id:"类的内部类"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#类的内部类"}},[n._v("#")]),n._v(" # 类的内部类")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('private static class Node<E> {\n    // 元素\n    volatile E item;\n    // next域\n    volatile Node<E> next;\n\n    /**\n        * Constructs a new node.  Uses relaxed write because item can\n        * only be seen after publication via casNext.\n        */\n    // 构造函数\n    Node(E item) {\n        // 设置item的值\n        UNSAFE.putObject(this, itemOffset, item);\n    }\n    // 比较并替换item值\n    boolean casItem(E cmp, E val) {\n        return UNSAFE.compareAndSwapObject(this, itemOffset, cmp, val);\n    }\n\n    void lazySetNext(Node<E> val) {\n        // 设置next域的值，并不会保证修改对其他线程立即可见\n        UNSAFE.putOrderedObject(this, nextOffset, val);\n    }\n    // 比较并替换next域的值\n    boolean casNext(Node<E> cmp, Node<E> val) {\n        return UNSAFE.compareAndSwapObject(this, nextOffset, cmp, val);\n    }\n\n    // Unsafe mechanics\n    // 反射机制\n    private static final sun.misc.Unsafe UNSAFE;\n    // item域的偏移量\n    private static final long itemOffset;\n    // next域的偏移量\n    private static final long nextOffset;\n\n    static {\n        try {\n            UNSAFE = sun.misc.Unsafe.getUnsafe();\n            Class<?> k = Node.class;\n            itemOffset = UNSAFE.objectFieldOffset\n                (k.getDeclaredField("item"));\n            nextOffset = UNSAFE.objectFieldOffset\n                (k.getDeclaredField("next"));\n        } catch (Exception e) {\n            throw new Error(e);\n        }\n    }\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br"),e("span",{staticClass:"line-number"},[n._v("39")]),e("br"),e("span",{staticClass:"line-number"},[n._v("40")]),e("br"),e("span",{staticClass:"line-number"},[n._v("41")]),e("br"),e("span",{staticClass:"line-number"},[n._v("42")]),e("br"),e("span",{staticClass:"line-number"},[n._v("43")]),e("br"),e("span",{staticClass:"line-number"},[n._v("44")]),e("br"),e("span",{staticClass:"line-number"},[n._v("45")]),e("br"),e("span",{staticClass:"line-number"},[n._v("46")]),e("br"),e("span",{staticClass:"line-number"},[n._v("47")]),e("br"),e("span",{staticClass:"line-number"},[n._v("48")]),e("br"),e("span",{staticClass:"line-number"},[n._v("49")]),e("br"),e("span",{staticClass:"line-number"},[n._v("50")]),e("br")])]),e("blockquote",[e("p",[n._v("说明: Node类表示链表结点，用于存放元素，包含item域和next域，item域表示元素，next域表示下一个结点，其利用反射机制和CAS机制来更新item域和next域，保证原子性。")])]),n._v(" "),e("h3",{attrs:{id:"类的属性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#类的属性"}},[n._v("#")]),n._v(" # 类的属性")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('public class ConcurrentLinkedQueue<E> extends AbstractQueue<E>\n        implements Queue<E>, java.io.Serializable {\n    // 版本序列号        \n    private static final long serialVersionUID = 196745693267521676L;\n    // 反射机制\n    private static final sun.misc.Unsafe UNSAFE;\n    // head域的偏移量\n    private static final long headOffset;\n    // tail域的偏移量\n    private static final long tailOffset;\n    static {\n        try {\n            UNSAFE = sun.misc.Unsafe.getUnsafe();\n            Class<?> k = ConcurrentLinkedQueue.class;\n            headOffset = UNSAFE.objectFieldOffset\n                (k.getDeclaredField("head"));\n            tailOffset = UNSAFE.objectFieldOffset\n                (k.getDeclaredField("tail"));\n        } catch (Exception e) {\n            throw new Error(e);\n        }\n    }\n\n    // 头节点\n    private transient volatile Node<E> head;\n    // 尾结点\n    private transient volatile Node<E> tail;\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br")])]),e("blockquote",[e("p",[n._v("说明: 属性中包含了head域和tail域，表示链表的头节点和尾结点，同时，ConcurrentLinkedQueue也使用了反射机制和CAS机制来更新头节点和尾结点，保证原子性。")])]),n._v(" "),e("h3",{attrs:{id:"类的构造函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#类的构造函数"}},[n._v("#")]),n._v(" # 类的构造函数")]),n._v(" "),e("ul",[e("li",[e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("ConcurrentLinkedQueue()\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br")])]),e("p",[n._v("型构造函数")])])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("public ConcurrentLinkedQueue() {\n    // 初始化头节点与尾结点\n    head = tail = new Node<E>(null);\n}\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br")])]),e("blockquote",[e("p",[n._v("说明: 该构造函数用于创建一个最初为空的 ConcurrentLinkedQueue，头节点与尾结点指向同一个结点，该结点的item域为null，next域也为null。")])]),n._v(" "),e("ul",[e("li",[e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("ConcurrentLinkedQueue(Collection<? extends E>)\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br")])]),e("p",[n._v("型构造函数")])])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("public ConcurrentLinkedQueue(Collection<? extends E> c) {\n    Node<E> h = null, t = null;\n    for (E e : c) { // 遍历c集合\n        // 保证元素不为空\n        checkNotNull(e);\n        // 新生一个结点\n        Node<E> newNode = new Node<E>(e);\n        if (h == null) // 头节点为null\n            // 赋值头节点与尾结点\n            h = t = newNode;\n        else {\n            // 直接头节点的next域\n            t.lazySetNext(newNode);\n            // 重新赋值头节点\n            t = newNode;\n        }\n    }\n    if (h == null) // 头节点为null\n        // 新生头节点与尾结点\n        h = t = new Node<E>(null);\n    // 赋值头节点\n    head = h;\n    // 赋值尾结点\n    tail = t;\n}\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br")])]),e("blockquote",[e("p",[n._v("说明: 该构造函数用于创建一个最初包含给定 collection 元素的 ConcurrentLinkedQueue，按照此 collection 迭代器的遍历顺序来添加元素。")])]),n._v(" "),e("h3",{attrs:{id:"核心函数分析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#核心函数分析"}},[n._v("#")]),n._v(" # 核心函数分析")]),n._v(" "),e("h4",{attrs:{id:"offer函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#offer函数"}},[n._v("#")]),n._v(" # offer函数")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('public boolean offer(E e) {\n    // 元素不为null\n    checkNotNull(e);\n    // 新生一个结点\n    final Node<E> newNode = new Node<E>(e);\n\n    for (Node<E> t = tail, p = t;;) { // 无限循环\n        // q为p结点的下一个结点\n        Node<E> q = p.next;\n        if (q == null) { // q结点为null\n            // p is last node\n            if (p.casNext(null, newNode)) { // 比较并进行替换p结点的next域\n                // Successful CAS is the linearization point\n                // for e to become an element of this queue,\n                // and for newNode to become "live".\n                if (p != t) // p不等于t结点，不一致    // hop two nodes at a time\n                    // 比较并替换尾结点\n                    casTail(t, newNode);  // Failure is OK.\n                // 返回\n                return true;\n            }\n            // Lost CAS race to another thread; re-read next\n        }\n        else if (p == q) // p结点等于q结点\n            // We have fallen off list.  If tail is unchanged, it\n            // will also be off-list, in which case we need to\n            // jump to head, from which all live nodes are always\n            // reachable.  Else the new tail is a better bet.\n            // 原来的尾结点与现在的尾结点是否相等，若相等，则p赋值为head，否则，赋值为现在的尾结点\n            p = (t != (t = tail)) ? t : head;\n        else\n            // Check for tail updates after two hops.\n            // 重新赋值p结点\n            p = (p != t && t != (t = tail)) ? t : q;\n    }\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br")])]),e("blockquote",[e("p",[n._v("说明: offer函数用于将指定元素插入此队列的尾部。下面模拟offer函数的操作，队列状态的变化(假设单线程添加元素，连续添加10、20两个元素)。")])]),n._v(" "),e("blockquote",[e("p",[n._v("![](./JUC集合_ ConcurrentLinkedQueue详解 _ Java 全栈知识体系_files/java-thread-x-juc-concurrentlinkedqueue-2.png)")])]),n._v(" "),e("ul",[e("li",[n._v("若ConcurrentLinkedQueue的初始状态如上图所示，即队列为空。单线程添加元素，此时，添加元素10，则状态如下所示")])]),n._v(" "),e("blockquote",[e("p",[n._v("![](./JUC集合_ ConcurrentLinkedQueue详解 _ Java 全栈知识体系_files/java-thread-x-juc-concurrentlinkedqueue-3.png)")])]),n._v(" "),e("ul",[e("li",[n._v("如上图所示，添加元素10后，tail没有变化，还是指向之前的结点，继续添加元素20，则状态如下所示")])]),n._v(" "),e("blockquote",[e("p",[n._v("![](./JUC集合_ ConcurrentLinkedQueue详解 _ Java 全栈知识体系_files/java-thread-x-juc-concurrentlinkedqueue-4.png)")])]),n._v(" "),e("ul",[e("li",[n._v("如上图所示，添加元素20后，tail指向了最新添加的结点。")])]),n._v(" "),e("h4",{attrs:{id:"poll函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#poll函数"}},[n._v("#")]),n._v(" # poll函数")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("public E poll() {\n    restartFromHead:\n    for (;;) { // 无限循环\n        for (Node<E> h = head, p = h, q;;) { // 保存头节点\n            // item项\n            E item = p.item;\n\n            if (item != null && p.casItem(item, null)) { // item不为null并且比较并替换item成功\n                // Successful CAS is the linearization point\n                // for item to be removed from this queue.\n                if (p != h) // p不等于h    // hop two nodes at a time\n                    // 更新头节点\n                    updateHead(h, ((q = p.next) != null) ? q : p); \n                // 返回item\n                return item;\n            }\n            else if ((q = p.next) == null) { // q结点为null\n                // 更新头节点\n                updateHead(h, p);\n                return null;\n            }\n            else if (p == q) // p等于q\n                // 继续循环\n                continue restartFromHead;\n            else\n                // p赋值为q\n                p = q;\n        }\n    }\n}\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br")])]),e("blockquote",[e("p",[n._v("说明: 此函数用于获取并移除此队列的头，如果此队列为空，则返回null。下面模拟poll函数的操作，队列状态的变化(假设单线程操作，状态为之前offer10、20后的状态，poll两次)。")])]),n._v(" "),e("blockquote",[e("p",[n._v("![](./JUC集合_ ConcurrentLinkedQueue详解 _ Java 全栈知识体系_files/java-thread-x-juc-concurrentlinkedqueue-5.png)")])]),n._v(" "),e("ul",[e("li",[n._v("队列初始状态如上图所示，在poll操作后，队列的状态如下图所示")])]),n._v(" "),e("blockquote",[e("p",[n._v("![](./JUC集合_ ConcurrentLinkedQueue详解 _ Java 全栈知识体系_files/java-thread-x-juc-concurrentlinkedqueue-6.png)")])]),n._v(" "),e("ul",[e("li",[n._v("如上图可知，poll操作后，head改变了，并且head所指向的结点的item变为了null。再进行一次poll操作，队列的状态如下图所示。")])]),n._v(" "),e("blockquote",[e("p",[n._v("![](./JUC集合_ ConcurrentLinkedQueue详解 _ Java 全栈知识体系_files/java-thread-x-juc-concurrentlinkedqueue-7.png)")])]),n._v(" "),e("ul",[e("li",[n._v("如上图可知，poll操作后，head结点没有变化，只是指示的结点的item域变成了null。")])]),n._v(" "),e("h4",{attrs:{id:"remove函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#remove函数"}},[n._v("#")]),n._v(" # remove函数")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("public boolean remove(Object o) {\n    // 元素为null，返回\n    if (o == null) return false;\n    Node<E> pred = null;\n    for (Node<E> p = first(); p != null; p = succ(p)) { // 获取第一个存活的结点\n        // 第一个存活结点的item值\n        E item = p.item;\n        if (item != null &&\n            o.equals(item) &&\n            p.casItem(item, null)) { // 找到item相等的结点，并且将该结点的item设置为null\n            // p的后继结点\n            Node<E> next = succ(p);\n            if (pred != null && next != null) // pred不为null并且next不为null\n                // 比较并替换next域\n                pred.casNext(p, next);\n            return true;\n        }\n        // pred赋值为p\n        pred = p;\n    }\n    return false;\n}\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br")])]),e("blockquote",[e("p",[n._v("说明: 此函数用于从队列中移除指定元素的单个实例(如果存在)。其中，会调用到first函数和succ函数，first函数的源码如下")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("Node<E> first() {\n    restartFromHead:\n    for (;;) { // 无限循环，确保成功\n        for (Node<E> h = head, p = h, q;;) {\n            // p结点的item域是否为null\n            boolean hasItem = (p.item != null);\n            if (hasItem || (q = p.next) == null) { // item不为null或者next域为null\n                // 更新头节点\n                updateHead(h, p);\n                // 返回结点\n                return hasItem ? p : null;\n            }\n            else if (p == q) // p等于q\n                // 继续从头节点开始\n                continue restartFromHead;\n            else\n                // p赋值为q\n                p = q;\n        }\n    }\n}\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br")])]),e("blockquote",[e("p",[n._v("说明: first函数用于找到链表中第一个存活的结点。succ函数源码如下")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("final Node<E> succ(Node<E> p) {\n    // p结点的next域\n    Node<E> next = p.next;\n    // 如果next域为自身，则返回头节点，否则，返回next\n    return (p == next) ? head : next;\n}\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br")])]),e("blockquote",[e("p",[n._v("说明: succ用于获取结点的下一个结点。如果结点的next域指向自身，则返回head头节点，否则，返回next结点。下面模拟remove函数的操作，队列状态的变化(假设单线程操作，状态为之前offer10、20后的状态，执行remove(10)、remove(20)操作)。")])]),n._v(" "),e("blockquote",[e("p",[n._v("![](./JUC集合_ ConcurrentLinkedQueue详解 _ Java 全栈知识体系_files/java-thread-x-juc-concurrentlinkedqueue-8.png)")])]),n._v(" "),e("ul",[e("li",[n._v("如上图所示，为ConcurrentLinkedQueue的初始状态，remove(10)后的状态如下图所示")])]),n._v(" "),e("blockquote",[e("p",[n._v("![](./JUC集合_ ConcurrentLinkedQueue详解 _ Java 全栈知识体系_files/java-thread-x-juc-concurrentlinkedqueue-9.png)")])]),n._v(" "),e("ul",[e("li",[n._v("如上图所示，当执行remove(10)后，head指向了head结点之前指向的结点的下一个结点，并且head结点的item域置为null。继续执行remove(20)，状态如下图所示")])]),n._v(" "),e("blockquote",[e("p",[n._v("![](./JUC集合_ ConcurrentLinkedQueue详解 _ Java 全栈知识体系_files/java-thread-x-juc-concurrentlinkedqueue-10.png)")])]),n._v(" "),e("ul",[e("li",[n._v("如上图所示，执行remove(20)后，head与tail指向同一个结点，item域为null。")])]),n._v(" "),e("h4",{attrs:{id:"size函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#size函数"}},[n._v("#")]),n._v(" # size函数")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("public int size() {\n    // 计数\n    int count = 0;\n    for (Node<E> p = first(); p != null; p = succ(p)) // 从第一个存活的结点开始往后遍历\n        if (p.item != null) // 结点的item域不为null\n            // Collection.size() spec says to max out\n            if (++count == Integer.MAX_VALUE) // 增加计数，若达到最大值，则跳出循环\n                break;\n    // 返回大小\n    return count;\n}\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br")])]),e("blockquote",[e("p",[n._v("说明: 此函数用于返回ConcurrenLinkedQueue的大小，从第一个存活的结点(first)开始，往后遍历链表，当结点的item域不为null时，增加计数，之后返回大小。")])]),n._v(" "),e("h3",{attrs:{id:"concurrentlinkedqueue示例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#concurrentlinkedqueue示例"}},[n._v("#")]),n._v(" # ConcurrentLinkedQueue示例")]),n._v(" "),e("blockquote",[e("p",[n._v("下面通过一个示例来了解ConcurrentLinkedQueue的使用")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('import java.util.concurrent.ConcurrentLinkedQueue;\n\nclass PutThread extends Thread {\n    private ConcurrentLinkedQueue<Integer> clq;\n    public PutThread(ConcurrentLinkedQueue<Integer> clq) {\n        this.clq = clq;\n    }\n\n    public void run() {\n        for (int i = 0; i < 10; i++) {\n            try {\n                System.out.println("add " + i);\n                clq.add(i);\n                Thread.sleep(100);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\nclass GetThread extends Thread {\n    private ConcurrentLinkedQueue<Integer> clq;\n    public GetThread(ConcurrentLinkedQueue<Integer> clq) {\n        this.clq = clq;\n    }\n\n    public void run() {\n        for (int i = 0; i < 10; i++) {\n            try {\n                System.out.println("poll " + clq.poll());\n                Thread.sleep(100);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\npublic class ConcurrentLinkedQueueDemo {\n    public static void main(String[] args) {\n        ConcurrentLinkedQueue<Integer> clq = new ConcurrentLinkedQueue<Integer>();\n        PutThread p1 = new PutThread(clq);\n        GetThread g1 = new GetThread(clq);\n\n        pstart();\n        gstart();\n\n    }\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br"),e("span",{staticClass:"line-number"},[n._v("39")]),e("br"),e("span",{staticClass:"line-number"},[n._v("40")]),e("br"),e("span",{staticClass:"line-number"},[n._v("41")]),e("br"),e("span",{staticClass:"line-number"},[n._v("42")]),e("br"),e("span",{staticClass:"line-number"},[n._v("43")]),e("br"),e("span",{staticClass:"line-number"},[n._v("44")]),e("br"),e("span",{staticClass:"line-number"},[n._v("45")]),e("br"),e("span",{staticClass:"line-number"},[n._v("46")]),e("br"),e("span",{staticClass:"line-number"},[n._v("47")]),e("br"),e("span",{staticClass:"line-number"},[n._v("48")]),e("br"),e("span",{staticClass:"line-number"},[n._v("49")]),e("br"),e("span",{staticClass:"line-number"},[n._v("50")]),e("br")])]),e("blockquote",[e("p",[n._v("运行结果(某一次):")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("add 0\npoll null\nadd 1\npoll 0\nadd 2\npoll 1\nadd 3\npoll 2\nadd 4\npoll 3\nadd 5\npoll 4\npoll 5\nadd 6\nadd 7\npoll 6\npoll 7\nadd 8\nadd 9\npoll 8\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br")])]),e("blockquote",[e("p",[n._v("说明: GetThread线程不会因为ConcurrentLinkedQueue队列为空而等待，而是直接返回null，所以当实现队列不空时，等待时，则需要用户自己实现等待逻辑。")])]),n._v(" "),e("h3",{attrs:{id:"再深入理解"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#再深入理解"}},[n._v("#")]),n._v(" # 再深入理解")]),n._v(" "),e("h3",{attrs:{id:"hops-延迟更新的策略-的设计"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hops-延迟更新的策略-的设计"}},[n._v("#")]),n._v(" # HOPS(延迟更新的策略)的设计")]),n._v(" "),e("blockquote",[e("p",[n._v("通过上面对offer和poll方法的分析，我们发现tail和head是延迟更新的，两者更新触发时机为：")])]),n._v(" "),e("ul",[e("li",[e("blockquote",[e("p",[e("code",[n._v("tail更新触发时机")]),n._v("：当tail指向的节点的下一个节点不为null的时候，会执行定位队列真正的队尾节点的操作，找到队尾节点后完成插入之后才会通过casTail进行tail更新；当tail指向的节点的下一个节点为null的时候，只插入节点不更新tail。")])])]),n._v(" "),e("li",[e("blockquote",[e("p",[e("code",[n._v("head更新触发时机")]),n._v("：当head指向的节点的item域为null的时候，会执行定位队列真正的队头节点的操作，找到队头节点后完成删除之后才会通过updateHead进行head更新；当head指向的节点的item域不为null的时候，只删除节点不更新head。")])])])]),n._v(" "),e("blockquote",[e("p",[n._v("并且在更新操作时，源码中会有注释为：")])]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("hop two nodes at a time\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br")])]),e("p",[n._v("。所以这种延迟更新的策略就被叫做HOPS的大概原因是这个(猜的 😃)，从上面更新时的状态图可以看出，head和tail的更新是跳着的即中间总是间隔了一个。那么这样设计的意图是什么呢?")]),n._v(" "),e("blockquote",[e("p",[n._v("如果让tail永远作为队列的队尾节点，实现的代码量会更少，而且逻辑更易懂。但是，这样做有一个缺点，如果大量的入队操作，每次都要执行CAS进行tail的更新，汇总起来对性能也会是大大的损耗。如果能减少CAS更新的操作，无疑可以大大提升入队的操作效率，所以doug lea大师每间隔1次(tail和队尾节点的距离为1)进行才利用CAS更新tail。对head的更新也是同样的道理，虽然，这样设计会多出在循环中定位队尾节点，但总体来说读的操作效率要远远高于写的性能，因此，多出来的在循环中定位尾节点的操作的性能损耗相对而言是很小的。")])]),n._v(" "),e("h3",{attrs:{id:"concurrentlinkedqueue适合的场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#concurrentlinkedqueue适合的场景"}},[n._v("#")]),n._v(" # ConcurrentLinkedQueue适合的场景")]),n._v(" "),e("blockquote",[e("p",[n._v("ConcurrentLinkedQueue通过无锁来做到了更高的并发量，是个高性能的队列，但是使用场景相对不如阻塞队列常见，毕竟取数据也要不停的去循环，不如阻塞的逻辑好设计，但是在并发量特别大的情况下，是个不错的选择，性能上好很多，而且这个队列的设计也是特别费力，尤其的使用的改良算法和对哨兵的处理。整体的思路都是比较严谨的，这个也是使用了无锁造成的，我们自己使用无锁的条件的话，这个队列是个不错的参考。")])]),n._v(" "),e("h3",{attrs:{id:"参考文章"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[n._v("#")]),n._v(" # 参考文章")]),n._v(" "),e("ul",[e("li",[n._v("文章主要参考自leesf的https://www.cnblogs.com/leesf456/p/5539142.html，在此基础上做了增改。")]),n._v(" "),e("li",[n._v("https://blog.csdn.net/u011521203/article/details/80214968")]),n._v(" "),e("li",[n._v("https://blog.csdn.net/u014493323/article/details/81177194")])])])}),[],!1,null,null,null);e.default=t.exports}}]);