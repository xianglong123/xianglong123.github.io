<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JUC原子类CAS, Unsafe和原子类详解 | 个人主页</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/images/photo.jpg">
    <link rel="manifest" href="/images/photo.jpg">
    <link rel="apple-touch-icon" href="/images/photo.jpg">
    <meta name="description" content="Personal Website">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
    <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.cfd1e9a2.css" as="style"><link rel="preload" href="/assets/js/app.0d6df2e4.js" as="script"><link rel="preload" href="/assets/js/3.2c60df78.js" as="script"><link rel="preload" href="/assets/js/74.8dbb42b8.js" as="script"><link rel="prefetch" href="/assets/js/10.a675ef31.js"><link rel="prefetch" href="/assets/js/100.c1d0cb0f.js"><link rel="prefetch" href="/assets/js/101.c3caeaf7.js"><link rel="prefetch" href="/assets/js/102.c33f1aeb.js"><link rel="prefetch" href="/assets/js/103.eddf2e86.js"><link rel="prefetch" href="/assets/js/104.943ce33b.js"><link rel="prefetch" href="/assets/js/105.d04687f0.js"><link rel="prefetch" href="/assets/js/106.2dfd0540.js"><link rel="prefetch" href="/assets/js/107.d0139f1c.js"><link rel="prefetch" href="/assets/js/108.24c68d63.js"><link rel="prefetch" href="/assets/js/109.a88c2829.js"><link rel="prefetch" href="/assets/js/11.561f08ee.js"><link rel="prefetch" href="/assets/js/110.ec9d9c92.js"><link rel="prefetch" href="/assets/js/111.a37b7b9f.js"><link rel="prefetch" href="/assets/js/112.862950f9.js"><link rel="prefetch" href="/assets/js/113.bf489717.js"><link rel="prefetch" href="/assets/js/114.0569b17d.js"><link rel="prefetch" href="/assets/js/115.cf784dec.js"><link rel="prefetch" href="/assets/js/116.92c16b65.js"><link rel="prefetch" href="/assets/js/117.991782bd.js"><link rel="prefetch" href="/assets/js/12.e4c2aa4a.js"><link rel="prefetch" href="/assets/js/13.35f9ed5a.js"><link rel="prefetch" href="/assets/js/14.b7f6f87c.js"><link rel="prefetch" href="/assets/js/15.808b42c3.js"><link rel="prefetch" href="/assets/js/16.9a65883a.js"><link rel="prefetch" href="/assets/js/17.dbfc7bb2.js"><link rel="prefetch" href="/assets/js/18.c329e942.js"><link rel="prefetch" href="/assets/js/19.83deeff3.js"><link rel="prefetch" href="/assets/js/2.40aa7bb6.js"><link rel="prefetch" href="/assets/js/20.bdd777c1.js"><link rel="prefetch" href="/assets/js/21.b486bbf9.js"><link rel="prefetch" href="/assets/js/22.a25a903b.js"><link rel="prefetch" href="/assets/js/23.925ff4e0.js"><link rel="prefetch" href="/assets/js/24.ceff7a46.js"><link rel="prefetch" href="/assets/js/25.760d6451.js"><link rel="prefetch" href="/assets/js/26.66b0e693.js"><link rel="prefetch" href="/assets/js/27.79296467.js"><link rel="prefetch" href="/assets/js/28.6f5b92df.js"><link rel="prefetch" href="/assets/js/29.f2b1ce52.js"><link rel="prefetch" href="/assets/js/30.3bafedc7.js"><link rel="prefetch" href="/assets/js/31.b967adc4.js"><link rel="prefetch" href="/assets/js/32.bfcba426.js"><link rel="prefetch" href="/assets/js/33.c838af1a.js"><link rel="prefetch" href="/assets/js/34.6f70f963.js"><link rel="prefetch" href="/assets/js/35.40935f03.js"><link rel="prefetch" href="/assets/js/36.bcf1bbbf.js"><link rel="prefetch" href="/assets/js/37.48e1a430.js"><link rel="prefetch" href="/assets/js/38.82997478.js"><link rel="prefetch" href="/assets/js/39.77436fc0.js"><link rel="prefetch" href="/assets/js/4.7d10bedd.js"><link rel="prefetch" href="/assets/js/40.bc3182ae.js"><link rel="prefetch" href="/assets/js/41.71103288.js"><link rel="prefetch" href="/assets/js/42.7690245a.js"><link rel="prefetch" href="/assets/js/43.d2d3d553.js"><link rel="prefetch" href="/assets/js/44.3f350618.js"><link rel="prefetch" href="/assets/js/45.97083dfb.js"><link rel="prefetch" href="/assets/js/46.a41e95bb.js"><link rel="prefetch" href="/assets/js/47.8540ef07.js"><link rel="prefetch" href="/assets/js/48.54629455.js"><link rel="prefetch" href="/assets/js/49.5f90d180.js"><link rel="prefetch" href="/assets/js/5.b88ed74c.js"><link rel="prefetch" href="/assets/js/50.7fa4c3a4.js"><link rel="prefetch" href="/assets/js/51.6ebb146b.js"><link rel="prefetch" href="/assets/js/52.fe6e9396.js"><link rel="prefetch" href="/assets/js/53.fa23c041.js"><link rel="prefetch" href="/assets/js/54.90582436.js"><link rel="prefetch" href="/assets/js/55.b8844963.js"><link rel="prefetch" href="/assets/js/56.5fd08d82.js"><link rel="prefetch" href="/assets/js/57.d57125ff.js"><link rel="prefetch" href="/assets/js/58.0696d91e.js"><link rel="prefetch" href="/assets/js/59.cf936091.js"><link rel="prefetch" href="/assets/js/6.d4fec8b7.js"><link rel="prefetch" href="/assets/js/60.e0404bbf.js"><link rel="prefetch" href="/assets/js/61.fd7b24c0.js"><link rel="prefetch" href="/assets/js/62.bab35282.js"><link rel="prefetch" href="/assets/js/63.bc3aab78.js"><link rel="prefetch" href="/assets/js/64.5f1bfff1.js"><link rel="prefetch" href="/assets/js/65.c431a11a.js"><link rel="prefetch" href="/assets/js/66.e2d06bb1.js"><link rel="prefetch" href="/assets/js/67.32853338.js"><link rel="prefetch" href="/assets/js/68.342b04c0.js"><link rel="prefetch" href="/assets/js/69.a1ce55b6.js"><link rel="prefetch" href="/assets/js/7.3197ebba.js"><link rel="prefetch" href="/assets/js/70.496c0997.js"><link rel="prefetch" href="/assets/js/71.31b35f4d.js"><link rel="prefetch" href="/assets/js/72.62ea27e4.js"><link rel="prefetch" href="/assets/js/73.2c961c77.js"><link rel="prefetch" href="/assets/js/75.f80b5005.js"><link rel="prefetch" href="/assets/js/76.07020749.js"><link rel="prefetch" href="/assets/js/77.930e3bad.js"><link rel="prefetch" href="/assets/js/78.fc6f0094.js"><link rel="prefetch" href="/assets/js/79.c72fd757.js"><link rel="prefetch" href="/assets/js/8.6e794918.js"><link rel="prefetch" href="/assets/js/80.8c9694ec.js"><link rel="prefetch" href="/assets/js/81.383d5cfc.js"><link rel="prefetch" href="/assets/js/82.1253ca4a.js"><link rel="prefetch" href="/assets/js/83.f0ff7a4d.js"><link rel="prefetch" href="/assets/js/84.5910af60.js"><link rel="prefetch" href="/assets/js/85.a9330cf0.js"><link rel="prefetch" href="/assets/js/86.e4b0497e.js"><link rel="prefetch" href="/assets/js/87.664f4a10.js"><link rel="prefetch" href="/assets/js/88.69b05471.js"><link rel="prefetch" href="/assets/js/89.4f1a869b.js"><link rel="prefetch" href="/assets/js/9.94dfd66d.js"><link rel="prefetch" href="/assets/js/90.91a54f02.js"><link rel="prefetch" href="/assets/js/91.cfe61516.js"><link rel="prefetch" href="/assets/js/92.99f20c42.js"><link rel="prefetch" href="/assets/js/93.dea260f7.js"><link rel="prefetch" href="/assets/js/94.4d34f33a.js"><link rel="prefetch" href="/assets/js/95.1977d5c8.js"><link rel="prefetch" href="/assets/js/96.07bc7add.js"><link rel="prefetch" href="/assets/js/97.548d05ca.js"><link rel="prefetch" href="/assets/js/98.3e689473.js"><link rel="prefetch" href="/assets/js/99.3382c108.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cfd1e9a2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java面向对象和基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/basic/java-basic-oop.html" class="nav-link">
  Java基础-面向对象
</a></li><li class="dropdown-subitem"><a href="/md/java/basic/java-basic-lan-basic.html" class="nav-link">
  Java基础-知识点
</a></li><li class="dropdown-subitem"><a href="/md/java/basic/java-basic-lan-sum.html" class="nav-link">
  Java 基础 - 图谱 &amp; Q/A
</a></li></ul></li><li class="dropdown-item"><h4>
          Java集合框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/collection/java-collection-all.html" class="nav-link">
  Java 集合框架详解
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - 并发框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-overview.html" class="nav-link">
  Java 并发知识体系
</a></li><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-theorty.html" class="nav-link">
  Java 并发理论基础
</a></li><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-thread-basic.html" class="nav-link">
  Java 并发线程基础
</a></li><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-juc-overview.html" class="nav-link">
  J.U.C 知识体系与详解
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - IO框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/io/java-io-overview.html" class="nav-link">
  Java IO/NIO/AIO详解
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - 新版本特性
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/java8/java8.html" class="nav-link">
  Java 8 特性详解
</a></li><li class="dropdown-subitem"><a href="/md/java/java8up/java-8-up-overview.html" class="nav-link">
  Java 8 以上版本特性体系
</a></li><li class="dropdown-subitem"><a href="/md/java/java8up/java9-11.html" class="nav-link">
  Java 8 升Java 11特性必读
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - JVM相关
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-classload.html" class="nav-link">
  Java 类加载机制
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-class.html" class="nav-link">
  Java 字节码和增强技术
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-struct.html" class="nav-link">
  JVM 内存结构详解
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-gc.html" class="nav-link">
  JVM 垃圾回收机制
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-debug-tools-linux.html" class="nav-link">
  Java 调试排错相关
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          数据库相关介绍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/db/info/mysql.html" class="nav-link">
  mysql
</a></li><li class="dropdown-subitem"><a href="/md/db/info/oracle.html" class="nav-link">
  oracle
</a></li><li class="dropdown-subitem"><a href="/md/db/info/h2.html" class="nav-link">
  h2
</a></li></ul></li><li class="dropdown-item"><h4>
          框架介绍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/db/frame/mybatis/mybatis-base-overview.html" class="nav-link">
  mybatis
</a></li><li class="dropdown-subitem"><a href="/md/db/frame/mp/mp-base-overview.html" class="nav-link">
  mybatis-plus
</a></li><li class="dropdown-subitem"><a href="/md/db/frame/jpa/jpa-base-overview.html" class="nav-link">
  jpa
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          redis
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/middleware/redis/redis-overview.html" class="nav-link">
  redis各大版本
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人记录" class="dropdown-title"><span class="title">个人记录</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人记录" class="mobile-dropdown-title"><span class="title">个人记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          2024
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/owner/2024/229-1.html" class="nav-link">
  vuepress打包报unsupported
</a></li><li class="dropdown-subitem"><a href="/md/owner/2024/229-2.html" class="nav-link">
  待定
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/xianglong123/cas-blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java面向对象和基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/basic/java-basic-oop.html" class="nav-link">
  Java基础-面向对象
</a></li><li class="dropdown-subitem"><a href="/md/java/basic/java-basic-lan-basic.html" class="nav-link">
  Java基础-知识点
</a></li><li class="dropdown-subitem"><a href="/md/java/basic/java-basic-lan-sum.html" class="nav-link">
  Java 基础 - 图谱 &amp; Q/A
</a></li></ul></li><li class="dropdown-item"><h4>
          Java集合框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/collection/java-collection-all.html" class="nav-link">
  Java 集合框架详解
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - 并发框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-overview.html" class="nav-link">
  Java 并发知识体系
</a></li><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-theorty.html" class="nav-link">
  Java 并发理论基础
</a></li><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-thread-basic.html" class="nav-link">
  Java 并发线程基础
</a></li><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-juc-overview.html" class="nav-link">
  J.U.C 知识体系与详解
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - IO框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/io/java-io-overview.html" class="nav-link">
  Java IO/NIO/AIO详解
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - 新版本特性
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/java8/java8.html" class="nav-link">
  Java 8 特性详解
</a></li><li class="dropdown-subitem"><a href="/md/java/java8up/java-8-up-overview.html" class="nav-link">
  Java 8 以上版本特性体系
</a></li><li class="dropdown-subitem"><a href="/md/java/java8up/java9-11.html" class="nav-link">
  Java 8 升Java 11特性必读
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - JVM相关
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-classload.html" class="nav-link">
  Java 类加载机制
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-class.html" class="nav-link">
  Java 字节码和增强技术
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-struct.html" class="nav-link">
  JVM 内存结构详解
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-gc.html" class="nav-link">
  JVM 垃圾回收机制
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-debug-tools-linux.html" class="nav-link">
  Java 调试排错相关
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          数据库相关介绍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/db/info/mysql.html" class="nav-link">
  mysql
</a></li><li class="dropdown-subitem"><a href="/md/db/info/oracle.html" class="nav-link">
  oracle
</a></li><li class="dropdown-subitem"><a href="/md/db/info/h2.html" class="nav-link">
  h2
</a></li></ul></li><li class="dropdown-item"><h4>
          框架介绍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/db/frame/mybatis/mybatis-base-overview.html" class="nav-link">
  mybatis
</a></li><li class="dropdown-subitem"><a href="/md/db/frame/mp/mp-base-overview.html" class="nav-link">
  mybatis-plus
</a></li><li class="dropdown-subitem"><a href="/md/db/frame/jpa/jpa-base-overview.html" class="nav-link">
  jpa
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          redis
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/middleware/redis/redis-overview.html" class="nav-link">
  redis各大版本
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人记录" class="dropdown-title"><span class="title">个人记录</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人记录" class="mobile-dropdown-title"><span class="title">个人记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          2024
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/owner/2024/229-1.html" class="nav-link">
  vuepress打包报unsupported
</a></li><li class="dropdown-subitem"><a href="/md/owner/2024/229-2.html" class="nav-link">
  待定
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/xianglong123/cas-blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java 基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/basic/java-basic-oop.html" class="sidebar-link">Java 基础 - 面向对象</a></li><li><a href="/md/java/basic/java-basic-lan-basic.html" class="sidebar-link">Java 基础 - 知识点</a></li><li><a href="/md/java/basic/java-basic-lan-sum.html" class="sidebar-link">Java 基础 - 图谱 &amp; Q/A</a></li><li><a href="/md/java/basic/java-basic-x-generic.html" class="sidebar-link">Java 基础 - 泛型机制详解</a></li><li><a href="/md/java/basic/java-basic-x-exception.html" class="sidebar-link">Java 基础 - 异常机制详解</a></li><li><a href="/md/java/basic/java-basic-x-reflection.html" class="sidebar-link">Java 基础 - 反射机制详解</a></li><li><a href="/md/java/advanced/java-advanced-spi.html" class="sidebar-link">Java常用机制 - SPI机制详解</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java 集合框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/collection/java-collection-all.html" class="sidebar-link">Collection 类关系图</a></li><li><a href="/md/java/collection/java-collection-ArrayList.html" class="sidebar-link">Collection - ArrayList 源码解析</a></li><li><a href="/md/java/collection/java-collection-LinkedList.html" class="sidebar-link">Collection - LinkedList源码解析</a></li><li><a href="/md/java/collection/java-collection-Queue&amp;Stack.html" class="sidebar-link">Collection - Stack &amp; Queue 源码解析</a></li><li><a href="/md/java/collection/java-collection-PriorityQueue.html" class="sidebar-link">Collection - PriorityQueue源码解析</a></li><li><a href="/md/java/collection/java-map-HashMap&amp;HashSet.html" class="sidebar-link">Map - HashSet &amp; HashMap 源码解析</a></li><li><a href="/md/java/collection/java-map-LinkedHashMap&amp;LinkedHashSet.html" class="sidebar-link">Map - LinkedHashSet&amp;Map源码解析</a></li><li><a href="/md/java/collection/java-map-TreeMap&amp;TreeSet.html" class="sidebar-link">Map - TreeSet &amp; TreeMap 源码解析</a></li><li><a href="/md/java/collection/java-map-WeakHashMap.html" class="sidebar-link">Map - WeakHashMap源码解析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java 多线程与并发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/thread/java-thread-x-overview.html" class="sidebar-link">♥Java并发知识体系详解♥</a></li><li><a href="/md/java/thread/java-thread-x-theorty.html" class="sidebar-link">Java 并发 - 理论基础</a></li><li><a href="/md/java/thread/java-thread-x-thread-basic.html" class="sidebar-link">Java 并发 - 线程基础</a></li><li><a href="/md/java/thread/java-thread-x-lock-all.html" class="sidebar-link">Java并发 - Java中所有的锁</a></li><li><a href="/md/java/thread/java-thread-x-key-synchronized.html" class="sidebar-link">关键字:synchronized详解</a></li><li><a href="/md/java/thread/java-thread-x-key-volatile.html" class="sidebar-link">关键字:volatile详解</a></li><li><a href="/md/java/thread/java-thread-x-key-final.html" class="sidebar-link">关键字:final详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-overview.html" class="sidebar-link">JUC - 类汇总和学习指南</a></li><li><a href="/md/java/thread/java-thread-x-juc-AtomicInteger.html" aria-current="page" class="active sidebar-link">JUC原子类CAS, Unsafe和原子类详解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/md/java/thread/java-thread-x-lock-LockSupport.html" class="sidebar-link">JUC锁:LockSupport详解</a></li><li><a href="/md/java/thread/java-thread-x-lock-AbstractQueuedSynchronizer.html" class="sidebar-link">JUC锁:锁核心类AQS详解</a></li><li><a href="/md/java/thread/java-thread-x-lock-ReentrantLock.html" class="sidebar-link">JUC锁:ReentrantLock详解</a></li><li><a href="/md/java/thread/java-thread-x-lock-ReentrantReadWriteLock.html" class="sidebar-link">JUC锁:ReentrantReadWriteLock详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-collection-ConcurrentHashMap.html" class="sidebar-link">JUC集合:ConcurrentHashMap详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-collection-CopyOnWriteArrayList.html" class="sidebar-link">JUC集合:CopyOnWriteArrayList详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-collection-ConcurrentLinkedQueue.html" class="sidebar-link">JUC集合:ConcurrentLinkedQueue详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-collection-BlockingQueue.html" class="sidebar-link">JUC集合:BlockingQueue详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-executor-FutureTask.html" class="sidebar-link">JUC线程池:FutureTask详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-executor-ThreadPoolExecutor.html" class="sidebar-link">JUC线程池:ThreadPoolExecutor详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-executor-ScheduledThreadPoolExecutor.html" class="sidebar-link">JUC线程池:ScheduledThreadPoolExecutor详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-executor-ForkJoinPool.html" class="sidebar-link">JUC线程池:Fork/Join框架详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-tool-countdownlatch.html" class="sidebar-link">JUC工具类:CountDownLatch详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-tool-cyclicbarrier.html" class="sidebar-link">JUC工具类:CyclicBarrier详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-tool-semaphore.html" class="sidebar-link">JUC工具类:Semaphore详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-tool-phaser.html" class="sidebar-link">JUC工具类:Phaser详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-tool-exchanger.html" class="sidebar-link">JUC工具类:Exchanger详解</a></li><li><a href="/md/java/thread/java-thread-x-threadlocal.html" class="sidebar-link">Java 并发 - ThreadLocal详解</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java IO/NIO/AIO</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/io/java-io-overview.html" class="sidebar-link">♥Java IO知识体系详解♥</a></li><li><a href="/md/java/io/java-io-basic-category.html" class="sidebar-link">Java IO - 分类(传输，操作)</a></li><li><a href="/md/java/io/java-io-basic-design-pattern.html" class="sidebar-link">Java IO - 设计模式(装饰者模式)</a></li><li><a href="/md/java/io/java-io-basic-code-inputstream.html" class="sidebar-link">Java IO - 源码:InputStream</a></li><li><a href="/md/java/io/java-io-basic-code-outputstream.html" class="sidebar-link">Java IO - 源码:OutputStream</a></li><li><a href="/md/java/io/java-io-basic-usage.html" class="sidebar-link">Java IO - 常见类使用</a></li><li><a href="/md/java/io/java-io-model.html" class="sidebar-link">IO 模型 - Unix IO 模型</a></li><li><a href="/md/java/io/java-io-bio.html" class="sidebar-link">Java IO - BIO 详解</a></li><li><a href="/md/java/io/java-io-nio.html" class="sidebar-link">Java NIO - 基础详解</a></li><li><a href="/md/java/io/java-io-nio-select-epoll.html" class="sidebar-link">Java NIO - IO多路复用详解</a></li><li><a href="/md/java/io/java-io-aio.html" class="sidebar-link">Java AIO - 异步IO详解</a></li><li><a href="/md/java/io/java-io-nio-netty.html" class="sidebar-link">Java N(A)IO - 框架:Netty</a></li><li><a href="/md/java/io/java-io-nio-zerocopy.html" class="sidebar-link">Java NIO - 零拷贝实现</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java8 特性详解</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/java8/java8.html" class="sidebar-link">♥Java8特性知识体系详解♥</a></li><li><a href="/md/java/java8/java8-stream.html" class="sidebar-link">Java 8 - 函数编程(lambda表达式)</a></li><li><a href="/md/java/java8/java8-optional.html" class="sidebar-link">Java 8 - Optional类深度解析</a></li><li><a href="/md/java/java8/java8-default.html" class="sidebar-link">Java 8 - 默认方法</a></li><li><a href="/md/java/java8/java8-type-anno.html" class="sidebar-link">Java 8 - 类型注解</a></li><li><a href="/md/java/java8/java8-anno-repeat.html" class="sidebar-link">Java 8 - 重复注解</a></li><li><a href="/md/java/java8/java8-type.html" class="sidebar-link">Java 8 - 类型推断优化</a></li><li><a href="/md/java/java8/java8-jre.html" class="sidebar-link">Java 8 - JRE精简</a></li><li><a href="/md/java/java8/java8-permgen.html" class="sidebar-link">Java 8 - 移除Permgen</a></li><li><a href="/md/java/java8/java8-stampedlock.html" class="sidebar-link">Java 8 - StampedLock</a></li><li><a href="/md/java/java8/java8-localdatetime.html" class="sidebar-link">Java 8 - LocalDate/LocalDateTime</a></li><li><a href="/md/java/java8/java8-javafx.html" class="sidebar-link">Java 8 - JavaFx 2.0</a></li><li><a href="/md/java/java8/java8-others.html" class="sidebar-link">Java 8 - 其它更新:字符串base64,...</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java8 以上特性概述</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/java8up/java-8-up-overview.html" class="sidebar-link">♥Java8+特性知识体系详解♥</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JVM相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/jvm/java-jvm-x-overview.html" class="sidebar-link">♥JVM相关知识体系详解♥</a></li><li><a href="/md/java/jvm/java-jvm-class.html" class="sidebar-link">JVM 基础 - 类字节码详解</a></li><li><a href="/md/java/jvm/java-jvm-class-enhancer.html" class="sidebar-link">JVM 基础 - 字节码的增强技术</a></li><li><a href="/md/java/jvm/java-jvm-classload.html" class="sidebar-link">JVM 基础 - Java 类加载机制</a></li><li><a href="/md/java/jvm/java-jvm-struct.html" class="sidebar-link">JVM 基础 - JVM 内存结构</a></li><li><a href="/md/java/jvm/java-jvm-x-introduce.html" class="sidebar-link">JVM 基础 - Java 内存模型引入</a></li><li><a href="/md/java/jvm/java-jvm-jmm.html" class="sidebar-link">JVM 基础 - Java 内存模型详解</a></li><li><a href="/md/java/jvm/java-jvm-gc.html" class="sidebar-link">GC - Java 垃圾回收基础知识</a></li><li><a href="/md/java/jvm/java-jvm-gc-g1.html" class="sidebar-link">GC - Java 垃圾回收器之G1详解</a></li><li><a href="/md/java/jvm/java-jvm-gc-zgc.html" class="sidebar-link">GC - Java 垃圾回收器之ZGC详解</a></li><li><a href="/md/java/jvm/java-jvm-cms-gc.html" class="sidebar-link">GC - Java 垃圾回收器之CMS GC问题分析与解决</a></li><li><a href="/md/java/jvm/java-jvm-param.html" class="sidebar-link">调试排错 - JVM 调优参数</a></li><li><a href="/md/java/jvm/java-jvm-oom.html" class="sidebar-link">调试排错 - Java 内存分析之堆内存和MetaSpace内存</a></li><li><a href="/md/java/jvm/java-jvm-oom-offheap.html" class="sidebar-link">调试排错 - Java 内存分析之堆外内存</a></li><li><a href="/md/java/jvm/java-jvm-thread-dump.html" class="sidebar-link">调试排错 - Java 线程分析之线程Dump分析</a></li><li><a href="/md/java/jvm/java-jvm-debug-tools-linux.html" class="sidebar-link">调试排错 - Java 问题排查之Linux命令</a></li><li><a href="/md/java/jvm/java-jvm-debug-tools-list.html" class="sidebar-link">调试排错 - Java 问题排查之工具单</a></li><li><a href="/md/java/jvm/java-jvm-oom-tool.html" class="sidebar-link">调试排错 - Java 问题排查之JVM可视化工具</a></li><li><a href="/md/java/jvm/java-jvm-agent-arthas.html" class="sidebar-link">调试排错 - Java 问题排查之应用在线调试Arthas</a></li><li><a href="/md/java/jvm/java-jvm-debug-idea.html" class="sidebar-link">调试排错 - Java 问题排查之使用IDEA本地调试和远程调试</a></li><li><a href="/md/java/jvm/java-jvm-agent-usage.html" class="sidebar-link">调试排错 - Java动态调试技术原理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="juc原子类cas-unsafe和原子类详解"><a href="#juc原子类cas-unsafe和原子类详解" class="header-anchor">#</a> JUC原子类CAS, Unsafe和原子类详解</h1> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>LockSupport是锁中的基础，是一个提供锁机制的工具类，所以先对其进行分析。 @123</p></div> <ul><li>JUC锁: LockSupport详解
<ul><li>带着BAT大厂的面试问题去理解</li> <li>LockSupport简介</li> <li>LockSupport源码分析
<ul><li>类的属性</li> <li>类的构造函数</li> <li>核心函数分析
<ul><li>park函数</li> <li>parkNanos函数</li> <li>parkUntil函数</li> <li>unpark函数</li></ul></li></ul></li> <li>LockSupport示例说明
<ul><li>使用wait/notify实现线程同步</li> <li>使用park/unpark实现线程同步</li> <li>中断响应</li></ul></li> <li>更深入的理解
<ul><li>Thread.sleep()和Object.wait()的区别</li> <li>Object.wait()和Condition.await()的区别</li> <li>Thread.sleep()和LockSupport.park()的区别</li> <li>Object.wait()和LockSupport.park()的区别
<ul><li>如果在wait()之前执行了notify()会怎样?</li> <li>如果在park()之前执行了unpark()会怎样?</li></ul></li> <li>LockSupport.park()会释放锁资源吗?</li></ul></li> <li>参考文章</li></ul></li></ul> <h3 id="带着bat大厂的面试问题去理解"><a href="#带着bat大厂的面试问题去理解" class="header-anchor">#</a> # 带着BAT大厂的面试问题去理解</h3> <blockquote><p>提示</p></blockquote> <blockquote><p>请带着这些问题继续后文，会很大程度上帮助你更好的理解相关知识点。@123</p></blockquote> <ul><li>为什么LockSupport也是核心基础类? AQS框架借助于两个类：Unsafe(提供CAS操作)和LockSupport(提供park/unpark操作)</li> <li>写出分别通过wait/notify和LockSupport的park/unpark实现同步?</li> <li>LockSupport.park()会释放锁资源吗? 那么Condition.await()呢?</li> <li>Thread.sleep()、Object.wait()、Condition.await()、LockSupport.park()的区别? 重点</li> <li>如果在wait()之前执行了notify()会怎样?</li> <li>如果在park()之前执行了unpark()会怎样?</li></ul> <h3 id="locksupport简介"><a href="#locksupport简介" class="header-anchor">#</a> # LockSupport简介</h3> <blockquote><p>LockSupport用来创建锁和其他同步类的基本线程阻塞原语。简而言之，当调用LockSupport.park时，表示当前线程将会等待，直至获得许可，当调用LockSupport.unpark时，必须把等待获得许可的线程作为参数进行传递，好让此线程继续运行。</p></blockquote> <h3 id="locksupport源码分析"><a href="#locksupport源码分析" class="header-anchor">#</a> # LockSupport源码分析</h3> <h3 id="类的属性"><a href="#类的属性" class="header-anchor">#</a> # 类的属性</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class LockSupport {
    // Hotspot implementation via intrinsics API
    private static final sun.misc.Unsafe UNSAFE;
    // 表示内存偏移地址
    private static final long parkBlockerOffset;
    // 表示内存偏移地址
    private static final long SEED;
    // 表示内存偏移地址
    private static final long PROBE;
    // 表示内存偏移地址
    private static final long SECONDARY;

    static {
        try {
            // 获取Unsafe实例
            UNSAFE = sun.misc.Unsafe.getUnsafe();
            // 线程类类型
            Class&lt;?&gt; tk = Thread.class;
            // 获取Thread的parkBlocker字段的内存偏移地址
            parkBlockerOffset = UNSAFE.objectFieldOffset
                (tk.getDeclaredField(&quot;parkBlocker&quot;));
            // 获取Thread的threadLocalRandomSeed字段的内存偏移地址
            SEED = UNSAFE.objectFieldOffset
                (tk.getDeclaredField(&quot;threadLocalRandomSeed&quot;));
            // 获取Thread的threadLocalRandomProbe字段的内存偏移地址
            PROBE = UNSAFE.objectFieldOffset
                (tk.getDeclaredField(&quot;threadLocalRandomProbe&quot;));
            // 获取Thread的threadLocalRandomSecondarySeed字段的内存偏移地址
            SECONDARY = UNSAFE.objectFieldOffset
                (tk.getDeclaredField(&quot;threadLocalRandomSecondarySeed&quot;));
        } catch (Exception ex) { throw new Error(ex); }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><blockquote><p>说明: UNSAFE字段表示sun.misc.Unsafe类，查看其源码，点击在这里，一般程序中不允许直接调用，而long型的表示实例对象相应字段在内存中的偏移地址，可以通过该偏移地址获取或者设置该字段的值。</p></blockquote> <h3 id="类的构造函数"><a href="#类的构造函数" class="header-anchor">#</a> # 类的构造函数</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 私有构造函数，无法被实例化
private LockSupport() {}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>说明: LockSupport只有一个私有构造函数，无法被实例化。</p></blockquote> <h3 id="核心函数分析"><a href="#核心函数分析" class="header-anchor">#</a> # 核心函数分析</h3> <blockquote><p>在分析LockSupport函数之前，先引入sun.misc.Unsafe类中的park和unpark函数，因为LockSupport的核心函数都是基于Unsafe类中定义的park和unpark函数，下面给出两个函数的定义:</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>public native void park(boolean isAbsolute, long time);
public native void unpark(Thread thread);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>说明: 对两个函数的说明如下:</p></blockquote> <ul><li><blockquote><p>park函数，阻塞线程，并且该线程在下列情况发生之前都会被阻塞: ① 调用unpark函数，释放该线程的许可。② 该线程被中断。③ 设置的时间到了。并且，当time为绝对时间时，isAbsolute为true，否则，isAbsolute为false。当time为0时，表示无限等待，直到unpark发生。</p></blockquote></li> <li><blockquote><p>unpark函数，释放线程的许可，即激活调用park后阻塞的线程。这个函数不是安全的，调用这个函数时要确保线程依旧存活。</p></blockquote></li></ul> <h4 id="park函数"><a href="#park函数" class="header-anchor">#</a> # park函数</h4> <blockquote><p>park函数有两个重载版本，方法摘要如下</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static void park()；
public static void park(Object blocker)；
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>说明: 两个函数的区别在于park()函数没有没有blocker，即没有设置线程的parkBlocker字段。park(Object)型函数如下。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static void park(Object blocker) {
    // 获取当前线程
    Thread t = Thread.currentThread();
    // 设置Blocker
    setBlocker(t, blocker);
    // 获取许可
    UNSAFE.park(false, 0L);
    // 重新可运行后再此设置Blocker
    setBlocker(t, null);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>说明: 调用park函数时，首先获取当前线程，然后设置当前线程的parkBlocker字段，即调用setBlocker函数，之后调用Unsafe类的park函数，之后再调用setBlocker函数。那么问题来了，为什么要在此park函数中要调用两次setBlocker函数呢? 原因其实很简单，调用park函数时，当前线程首先设置好parkBlocker字段，然后再调用Unsafe的park函数，此后，当前线程就已经阻塞了，等待该线程的unpark函数被调用，所以后面的一个setBlocker函数无法运行，unpark函数被调用，该线程获得许可后，就可以继续运行了，也就运行第二个setBlocker，把该线程的parkBlocker字段设置为null，这样就完成了整个park函数的逻辑。如果没有第二个setBlocker，那么之后没有调用park(Object blocker)，而直接调用getBlocker函数，得到的还是前一个park(Object blocker)设置的blocker，显然是不符合逻辑的。总之，必须要保证在park(Object blocker)整个函数执行完后，该线程的parkBlocker字段又恢复为null。所以，park(Object)型函数里必须要调用setBlocker函数两次。setBlocker方法如下。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>private static void setBlocker(Thread t, Object arg) {
    // 设置线程t的parkBlocker字段的值为arg
    UNSAFE.putObject(t, parkBlockerOffset, arg);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>说明: 此方法用于设置线程t的parkBlocker字段的值为arg。</p></blockquote> <blockquote><p>另外一个无参重载版本，park()函数如下。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static void park() {
    // 获取许可，设置时间为无限长，直到可以获取许可
    UNSAFE.park(false, 0L);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>说明: 调用了park函数后，会禁用当前线程，除非许可可用。在以下三种情况之一发生之前，当前线程都将处于休眠状态，即下列情况发生时，当前线程会获取许可，可以继续运行。</p></blockquote> <ul><li>其他某个线程将当前线程作为目标调用 unpark。</li> <li>其他某个线程中断当前线程。</li> <li>该调用不合逻辑地(即毫无理由地)返回。</li></ul> <h4 id="parknanos函数"><a href="#parknanos函数" class="header-anchor">#</a> # parkNanos函数</h4> <blockquote><p>此函数表示在许可可用前禁用当前线程，并最多等待指定的等待时间。具体函数如下。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static void parkNanos(Object blocker, long nanos) {
    if (nanos &gt; 0) { // 时间大于0
        // 获取当前线程
        Thread t = Thread.currentThread();
        // 设置Blocker
        setBlocker(t, blocker);
        // 获取许可，并设置了时间
        UNSAFE.park(false, nanos);
        // 设置许可
        setBlocker(t, null);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>说明: 该函数也是调用了两次setBlocker函数，nanos参数表示相对时间，表示等待多长时间。</p></blockquote> <h4 id="parkuntil函数"><a href="#parkuntil函数" class="header-anchor">#</a> # parkUntil函数</h4> <blockquote><p>此函数表示在指定的时限前禁用当前线程，除非许可可用, 具体函数如下:</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static void parkUntil(Object blocker, long deadline) {
    // 获取当前线程
    Thread t = Thread.currentThread();
    // 设置Blocker
    setBlocker(t, blocker);
    UNSAFE.park(true, deadline);
    // 设置Blocker为null
    setBlocker(t, null);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>说明: 该函数也调用了两次setBlocker函数，deadline参数表示绝对时间，表示指定的时间。</p></blockquote> <h4 id="unpark函数"><a href="#unpark函数" class="header-anchor">#</a> # unpark函数</h4> <blockquote><p>此函数表示如果给定线程的许可尚不可用，则使其可用。如果线程在 park 上受阻塞，则它将解除其阻塞状态。否则，保证下一次调用 park 不会受阻塞。如果给定线程尚未启动，则无法保证此操作有任何效果。具体函数如下:</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>public static void unpark(Thread thread) {
    if (thread != null) // 线程为不空
        UNSAFE.unpark(thread); // 释放该线程许可
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>说明: 释放许可，指定线程可以继续运行。</p></blockquote> <h3 id="locksupport示例说明"><a href="#locksupport示例说明" class="header-anchor">#</a> # LockSupport示例说明</h3> <h3 id="使用wait-notify实现线程同步"><a href="#使用wait-notify实现线程同步" class="header-anchor">#</a> # 使用wait/notify实现线程同步</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>class MyThread extends Thread {

    public void run() {
        synchronized (this) {
            System.out.println(&quot;before notify&quot;);            
            notify();
            System.out.println(&quot;after notify&quot;);    
        }
    }
}

public class WaitAndNotifyDemo {
    public static void main(String[] args) throws InterruptedException {
        MyThread myThread = new MyThread();            
        synchronized (myThread) {
            try {        
                myThread.start();
                // 主线程睡眠3s
                Thread.sleep(3000);
                System.out.println(&quot;before wait&quot;);
                // 阻塞主线程
                myThread.wait();
                System.out.println(&quot;after wait&quot;);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }            
        }        
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><blockquote><p>运行结果</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>before wait
before notify
after notify
after wait
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>说明: 具体的流程图如下</p></blockquote> <blockquote><p><img src="data:image/png;base64,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" alt=""></p></blockquote> <blockquote><p>使用wait/notify实现同步时，必须先调用wait，后调用notify，如果先调用notify，再调用wait，将起不了作用。具体代码如下</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>class MyThread extends Thread {
    public void run() {
        synchronized (this) {
            System.out.println(&quot;before notify&quot;);            
            notify();
            System.out.println(&quot;after notify&quot;);    
        }
    }
}

public class WaitAndNotifyDemo {
    public static void main(String[] args) throws InterruptedException {
        MyThread myThread = new MyThread();        
        myThread.start();
        // 主线程睡眠3s
        Thread.sleep(3000);
        synchronized (myThread) {
            try {        
                System.out.println(&quot;before wait&quot;);
                // 阻塞主线程
                myThread.wait();
                System.out.println(&quot;after wait&quot;);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }            
        }        
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><blockquote><p>运行结果:</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>before notify
after notify
before wait
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>说明: 由于先调用了notify，再调用的wait，此时主线程还是会一直阻塞。</p></blockquote> <h3 id="使用park-unpark实现线程同步"><a href="#使用park-unpark实现线程同步" class="header-anchor">#</a> # 使用park/unpark实现线程同步</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.locks.LockSupport;

class MyThread extends Thread {
    private Object object;

    public MyThread(Object object) {
        this.object = object;
    }

    public void run() {
        System.out.println(&quot;before unpark&quot;);
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        // 获取blocker
        System.out.println(&quot;Blocker info &quot; + LockSupport.getBlocker((Thread) object));
        // 释放许可
        LockSupport.unpark((Thread) object);
        // 休眠500ms，保证先执行park中的setBlocker(t, null);
        try {
            Thread.sleep(500);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        // 再次获取blocker
        System.out.println(&quot;Blocker info &quot; + LockSupport.getBlocker((Thread) object));

        System.out.println(&quot;after unpark&quot;);
    }
}

public class test {
    public static void main(String[] args) {
        MyThread myThread = new MyThread(Thread.currentThread());
        myThread.start();
        System.out.println(&quot;before park&quot;);
        // 获取许可
        LockSupport.park(&quot;ParkAndUnparkDemo&quot;);
        System.out.println(&quot;after park&quot;);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><blockquote><p>运行结果:</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>before park
before unpark
Blocker info ParkAndUnparkDemo
after park
Blocker info null
after unpark
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>说明: 本程序先执行park，然后在执行unpark，进行同步，并且在unpark的前后都调用了getBlocker，可以看到两次的结果不一样，并且第二次调用的结果为null，这是因为在调用unpark之后，执行了Lock.park(Object blocker)函数中的setBlocker(t, null)函数，所以第二次调用getBlocker时为null。</p></blockquote> <blockquote><p>上例是先调用park，然后调用unpark，现在修改程序，先调用unpark，然后调用park，看能不能正确同步。具体代码如下</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.locks.LockSupport;

class MyThread extends Thread {
    private Object object;

    public MyThread(Object object) {
        this.object = object;
    }

    public void run() {
        System.out.println(&quot;before unpark&quot;);        
        // 释放许可
        LockSupport.unpark((Thread) object);
        System.out.println(&quot;after unpark&quot;);
    }
}

public class ParkAndUnparkDemo {
    public static void main(String[] args) {
        MyThread myThread = new MyThread(Thread.currentThread());
        myThread.start();
        try {
            // 主线程睡眠3s
            Thread.sleep(3000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(&quot;before park&quot;);
        // 获取许可
        LockSupport.park(&quot;ParkAndUnparkDemo&quot;);
        System.out.println(&quot;after park&quot;);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><blockquote><p>运行结果:</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>before unpark
after unpark
before park
after park
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>说明: 可以看到，在先调用unpark，再调用park时，仍能够正确实现同步，不会造成由wait/notify调用顺序不当所引起的阻塞。因此park/unpark相比wait/notify更加的灵活。</p></blockquote> <h3 id="中断响应"><a href="#中断响应" class="header-anchor">#</a> # 中断响应</h3> <blockquote><p>看下面示例</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.locks.LockSupport;

class MyThread extends Thread {
    private Object object;

    public MyThread(Object object) {
        this.object = object;
    }

    public void run() {
        System.out.println(&quot;before interrupt&quot;);        
        try {
            // 休眠3s
            Thread.sleep(3000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }    
        Thread thread = (Thread) object;
        // 中断线程
        thread.interrupt();
        System.out.println(&quot;after interrupt&quot;);
    }
}

public class InterruptDemo {
    public static void main(String[] args) {
        MyThread myThread = new MyThread(Thread.currentThread());
        myThread.start();
        System.out.println(&quot;before park&quot;);
        // 获取许可
        LockSupport.park(&quot;ParkAndUnparkDemo&quot;);
        System.out.println(&quot;after park&quot;);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><blockquote><p>运行结果:</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>before park
before interrupt
after interrupt
after park
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>说明: 可以看到，在主线程调用park阻塞后，在myThread线程中发出了中断信号，此时主线程会继续运行，也就是说明此时interrupt起到的作用与unpark一样。</p></blockquote> <h3 id="更深入的理解"><a href="#更深入的理解" class="header-anchor">#</a> # 更深入的理解</h3> <h3 id="thread-sleep-和object-wait-的区别"><a href="#thread-sleep-和object-wait-的区别" class="header-anchor">#</a> # Thread.sleep()和Object.wait()的区别</h3> <blockquote><p>首先，我们先来看看Thread.sleep()和Object.wait()的区别，这是一个烂大街的题目了，大家应该都能说上来两点。</p></blockquote> <ul><li>Thread.sleep()不会释放占有的锁，Object.wait()会释放占有的锁；</li> <li>Thread.sleep()必须传入时间，Object.wait()可传可不传，不传表示一直阻塞下去；</li> <li>Thread.sleep()到时间了会自动唤醒，然后继续执行；</li> <li>Object.wait()不带时间的，需要另一个线程使用Object.notify()唤醒；</li> <li>Object.wait()带时间的，假如没有被notify，到时间了会自动唤醒，这时又分好两种情况，一是立即获取到了锁，线程自然会继续执行；二是没有立即获取锁，线程进入同步队列等待获取锁；</li></ul> <blockquote><p>其实，他们俩最大的区别就是Thread.sleep()不会释放锁资源，Object.wait()会释放锁资源。</p></blockquote> <h3 id="object-wait-和condition-await-的区别"><a href="#object-wait-和condition-await-的区别" class="header-anchor">#</a> # Object.wait()和Condition.await()的区别</h3> <blockquote><p>Object.wait()和Condition.await()的原理是基本一致的，不同的是Condition.await()底层是调用LockSupport.park()来实现阻塞当前线程的。</p></blockquote> <blockquote><p>实际上，它在阻塞当前线程之前还干了两件事，一是把当前线程添加到条件队列中，二是完全释放锁，也就是让state状态变量变为0，然后才是调用LockSupport.park()阻塞当前线程。</p></blockquote> <h3 id="thread-sleep-和locksupport-park-的区别"><a href="#thread-sleep-和locksupport-park-的区别" class="header-anchor">#</a> # Thread.sleep()和LockSupport.park()的区别</h3> <blockquote><p>LockSupport.park()还有几个兄弟方法——parkNanos()、parkUtil()等，我们这里说的park()方法统称这一类方法。</p></blockquote> <ul><li>从功能上来说，Thread.sleep()和LockSupport.park()方法类似，都是阻塞当前线程的执行，且都不会释放当前线程占有的锁资源；</li> <li>Thread.sleep()没法从外部唤醒，只能自己醒过来；</li> <li>LockSupport.park()方法可以被另一个线程调用LockSupport.unpark()方法唤醒；</li> <li>Thread.sleep()方法声明上抛出了InterruptedException中断异常，所以调用者需要捕获这个异常或者再抛出；</li> <li>LockSupport.park()方法不需要捕获中断异常；</li> <li>Thread.sleep()本身就是一个native方法；</li> <li>LockSupport.park()底层是调用的Unsafe的native方法；</li></ul> <h3 id="object-wait-和locksupport-park-的区别"><a href="#object-wait-和locksupport-park-的区别" class="header-anchor">#</a> # Object.wait()和LockSupport.park()的区别</h3> <blockquote><p>二者都会阻塞当前线程的运行，他们有什么区别呢? 经过上面的分析相信你一定很清楚了，真的吗? 往下看！</p></blockquote> <ul><li>Object.wait()方法需要在synchronized块中执行；</li> <li>LockSupport.park()可以在任意地方执行；</li> <li>Object.wait()方法声明抛出了中断异常，调用者需要捕获或者再抛出；</li> <li>LockSupport.park()不需要捕获中断异常；</li> <li>Object.wait()不带超时的，需要另一个线程执行notify()来唤醒，但不一定继续执行后续内容；</li> <li>LockSupport.park()不带超时的，需要另一个线程执行unpark()来唤醒，一定会继续执行后续内容；</li></ul> <blockquote><p>park()/unpark()底层的原理是二元信号量，你可以把它相像成只有一个许可证的Semaphore，只不过这个信号量在重复执行unpark()的时候也不会再增加许可证，最多只有一个许可证。</p></blockquote> <h4 id="如果在wait-之前执行了notify-会怎样"><a href="#如果在wait-之前执行了notify-会怎样" class="header-anchor">#</a> # 如果在wait()之前执行了notify()会怎样?</h4> <blockquote><p>如果当前的线程不是此对象锁的所有者，却调用该对象的notify()或wait()方法时抛出IllegalMonitorStateException异常；</p></blockquote> <blockquote><p>如果当前线程是此对象锁的所有者，wait()将一直阻塞，因为后续将没有其它notify()唤醒它。</p></blockquote> <h4 id="如果在park-之前执行了unpark-会怎样"><a href="#如果在park-之前执行了unpark-会怎样" class="header-anchor">#</a> # 如果在park()之前执行了unpark()会怎样?</h4> <blockquote><p>线程不会被阻塞，直接跳过park()，继续执行后续内容</p></blockquote> <h3 id="locksupport-park-会释放锁资源吗"><a href="#locksupport-park-会释放锁资源吗" class="header-anchor">#</a> # LockSupport.park()会释放锁资源吗?</h3> <blockquote><p>不会，它只负责阻塞当前线程，释放锁资源实际上是在Condition的await()方法中实现的。</p></blockquote> <h3 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> # 参考文章</h3> <ul><li>文章主要参考自leesf的https://www.cnblogs.com/leesf456/p/5347293.html，在此基础上做了增改。</li> <li>https://blog.csdn.net/tangtong1/article/details/102829724</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/13/2023, 11:19:20 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/md/java/thread/java-thread-x-juc-overview.html" class="prev">
        JUC - 类汇总和学习指南
      </a></span> <span class="next"><a href="/md/java/thread/java-thread-x-lock-LockSupport.html">
        JUC锁:LockSupport详解
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:290px;display:none;" data-v-5775ee02>
      欢迎来到我的博客
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="260px" height="320" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><canvas id="vuepress-canvas-cursor"></canvas><!----><div class="RibbonAnimation"></div><!----><div class="Sakura" data-v-248d85d6><canvas id="canvas_sakura" style="z-index:2;" data-v-248d85d6></canvas></div></div></div>
    <script src="/assets/js/app.0d6df2e4.js" defer></script><script src="/assets/js/3.2c60df78.js" defer></script><script src="/assets/js/74.8dbb42b8.js" defer></script>
  </body>
</html>
