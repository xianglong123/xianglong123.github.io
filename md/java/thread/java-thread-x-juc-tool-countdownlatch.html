<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JUC工具类:CountDownLatch详解 | 个人主页</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/images/photo.jpg">
    <link rel="manifest" href="/images/photo.jpg">
    <link rel="apple-touch-icon" href="/images/photo.jpg">
    <meta name="description" content="Personal Website">
    <meta http-quiv="pragma" cotent="no-cache">
    <meta http-quiv="pragma" cotent="no-cache,must-revalidate">
    <meta http-quiv="expires" cotent="0">
    
    <link rel="preload" href="/assets/css/0.styles.cfd1e9a2.css" as="style"><link rel="preload" href="/assets/js/app.0d6df2e4.js" as="script"><link rel="preload" href="/assets/js/3.2c60df78.js" as="script"><link rel="preload" href="/assets/js/17.dbfc7bb2.js" as="script"><link rel="prefetch" href="/assets/js/10.a675ef31.js"><link rel="prefetch" href="/assets/js/100.c1d0cb0f.js"><link rel="prefetch" href="/assets/js/101.c3caeaf7.js"><link rel="prefetch" href="/assets/js/102.c33f1aeb.js"><link rel="prefetch" href="/assets/js/103.eddf2e86.js"><link rel="prefetch" href="/assets/js/104.943ce33b.js"><link rel="prefetch" href="/assets/js/105.d04687f0.js"><link rel="prefetch" href="/assets/js/106.2dfd0540.js"><link rel="prefetch" href="/assets/js/107.d0139f1c.js"><link rel="prefetch" href="/assets/js/108.24c68d63.js"><link rel="prefetch" href="/assets/js/109.a88c2829.js"><link rel="prefetch" href="/assets/js/11.561f08ee.js"><link rel="prefetch" href="/assets/js/110.ec9d9c92.js"><link rel="prefetch" href="/assets/js/111.a37b7b9f.js"><link rel="prefetch" href="/assets/js/112.862950f9.js"><link rel="prefetch" href="/assets/js/113.bf489717.js"><link rel="prefetch" href="/assets/js/114.0569b17d.js"><link rel="prefetch" href="/assets/js/115.cf784dec.js"><link rel="prefetch" href="/assets/js/116.92c16b65.js"><link rel="prefetch" href="/assets/js/117.991782bd.js"><link rel="prefetch" href="/assets/js/12.e4c2aa4a.js"><link rel="prefetch" href="/assets/js/13.35f9ed5a.js"><link rel="prefetch" href="/assets/js/14.b7f6f87c.js"><link rel="prefetch" href="/assets/js/15.808b42c3.js"><link rel="prefetch" href="/assets/js/16.9a65883a.js"><link rel="prefetch" href="/assets/js/18.c329e942.js"><link rel="prefetch" href="/assets/js/19.83deeff3.js"><link rel="prefetch" href="/assets/js/2.40aa7bb6.js"><link rel="prefetch" href="/assets/js/20.bdd777c1.js"><link rel="prefetch" href="/assets/js/21.b486bbf9.js"><link rel="prefetch" href="/assets/js/22.a25a903b.js"><link rel="prefetch" href="/assets/js/23.925ff4e0.js"><link rel="prefetch" href="/assets/js/24.ceff7a46.js"><link rel="prefetch" href="/assets/js/25.760d6451.js"><link rel="prefetch" href="/assets/js/26.66b0e693.js"><link rel="prefetch" href="/assets/js/27.79296467.js"><link rel="prefetch" href="/assets/js/28.6f5b92df.js"><link rel="prefetch" href="/assets/js/29.f2b1ce52.js"><link rel="prefetch" href="/assets/js/30.3bafedc7.js"><link rel="prefetch" href="/assets/js/31.b967adc4.js"><link rel="prefetch" href="/assets/js/32.bfcba426.js"><link rel="prefetch" href="/assets/js/33.c838af1a.js"><link rel="prefetch" href="/assets/js/34.6f70f963.js"><link rel="prefetch" href="/assets/js/35.40935f03.js"><link rel="prefetch" href="/assets/js/36.bcf1bbbf.js"><link rel="prefetch" href="/assets/js/37.48e1a430.js"><link rel="prefetch" href="/assets/js/38.82997478.js"><link rel="prefetch" href="/assets/js/39.77436fc0.js"><link rel="prefetch" href="/assets/js/4.7d10bedd.js"><link rel="prefetch" href="/assets/js/40.bc3182ae.js"><link rel="prefetch" href="/assets/js/41.71103288.js"><link rel="prefetch" href="/assets/js/42.7690245a.js"><link rel="prefetch" href="/assets/js/43.d2d3d553.js"><link rel="prefetch" href="/assets/js/44.3f350618.js"><link rel="prefetch" href="/assets/js/45.97083dfb.js"><link rel="prefetch" href="/assets/js/46.a41e95bb.js"><link rel="prefetch" href="/assets/js/47.8540ef07.js"><link rel="prefetch" href="/assets/js/48.54629455.js"><link rel="prefetch" href="/assets/js/49.5f90d180.js"><link rel="prefetch" href="/assets/js/5.b88ed74c.js"><link rel="prefetch" href="/assets/js/50.7fa4c3a4.js"><link rel="prefetch" href="/assets/js/51.6ebb146b.js"><link rel="prefetch" href="/assets/js/52.fe6e9396.js"><link rel="prefetch" href="/assets/js/53.fa23c041.js"><link rel="prefetch" href="/assets/js/54.90582436.js"><link rel="prefetch" href="/assets/js/55.b8844963.js"><link rel="prefetch" href="/assets/js/56.5fd08d82.js"><link rel="prefetch" href="/assets/js/57.d57125ff.js"><link rel="prefetch" href="/assets/js/58.0696d91e.js"><link rel="prefetch" href="/assets/js/59.cf936091.js"><link rel="prefetch" href="/assets/js/6.d4fec8b7.js"><link rel="prefetch" href="/assets/js/60.e0404bbf.js"><link rel="prefetch" href="/assets/js/61.fd7b24c0.js"><link rel="prefetch" href="/assets/js/62.bab35282.js"><link rel="prefetch" href="/assets/js/63.bc3aab78.js"><link rel="prefetch" href="/assets/js/64.5f1bfff1.js"><link rel="prefetch" href="/assets/js/65.c431a11a.js"><link rel="prefetch" href="/assets/js/66.e2d06bb1.js"><link rel="prefetch" href="/assets/js/67.32853338.js"><link rel="prefetch" href="/assets/js/68.342b04c0.js"><link rel="prefetch" href="/assets/js/69.a1ce55b6.js"><link rel="prefetch" href="/assets/js/7.3197ebba.js"><link rel="prefetch" href="/assets/js/70.496c0997.js"><link rel="prefetch" href="/assets/js/71.31b35f4d.js"><link rel="prefetch" href="/assets/js/72.62ea27e4.js"><link rel="prefetch" href="/assets/js/73.2c961c77.js"><link rel="prefetch" href="/assets/js/74.8dbb42b8.js"><link rel="prefetch" href="/assets/js/75.f80b5005.js"><link rel="prefetch" href="/assets/js/76.07020749.js"><link rel="prefetch" href="/assets/js/77.930e3bad.js"><link rel="prefetch" href="/assets/js/78.fc6f0094.js"><link rel="prefetch" href="/assets/js/79.c72fd757.js"><link rel="prefetch" href="/assets/js/8.6e794918.js"><link rel="prefetch" href="/assets/js/80.8c9694ec.js"><link rel="prefetch" href="/assets/js/81.383d5cfc.js"><link rel="prefetch" href="/assets/js/82.1253ca4a.js"><link rel="prefetch" href="/assets/js/83.f0ff7a4d.js"><link rel="prefetch" href="/assets/js/84.5910af60.js"><link rel="prefetch" href="/assets/js/85.a9330cf0.js"><link rel="prefetch" href="/assets/js/86.e4b0497e.js"><link rel="prefetch" href="/assets/js/87.664f4a10.js"><link rel="prefetch" href="/assets/js/88.69b05471.js"><link rel="prefetch" href="/assets/js/89.4f1a869b.js"><link rel="prefetch" href="/assets/js/9.94dfd66d.js"><link rel="prefetch" href="/assets/js/90.91a54f02.js"><link rel="prefetch" href="/assets/js/91.cfe61516.js"><link rel="prefetch" href="/assets/js/92.99f20c42.js"><link rel="prefetch" href="/assets/js/93.dea260f7.js"><link rel="prefetch" href="/assets/js/94.4d34f33a.js"><link rel="prefetch" href="/assets/js/95.1977d5c8.js"><link rel="prefetch" href="/assets/js/96.07bc7add.js"><link rel="prefetch" href="/assets/js/97.548d05ca.js"><link rel="prefetch" href="/assets/js/98.3e689473.js"><link rel="prefetch" href="/assets/js/99.3382c108.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cfd1e9a2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java面向对象和基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/basic/java-basic-oop.html" class="nav-link">
  Java基础-面向对象
</a></li><li class="dropdown-subitem"><a href="/md/java/basic/java-basic-lan-basic.html" class="nav-link">
  Java基础-知识点
</a></li><li class="dropdown-subitem"><a href="/md/java/basic/java-basic-lan-sum.html" class="nav-link">
  Java 基础 - 图谱 &amp; Q/A
</a></li></ul></li><li class="dropdown-item"><h4>
          Java集合框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/collection/java-collection-all.html" class="nav-link">
  Java 集合框架详解
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - 并发框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-overview.html" class="nav-link">
  Java 并发知识体系
</a></li><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-theorty.html" class="nav-link">
  Java 并发理论基础
</a></li><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-thread-basic.html" class="nav-link">
  Java 并发线程基础
</a></li><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-juc-overview.html" class="nav-link">
  J.U.C 知识体系与详解
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - IO框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/io/java-io-overview.html" class="nav-link">
  Java IO/NIO/AIO详解
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - 新版本特性
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/java8/java8.html" class="nav-link">
  Java 8 特性详解
</a></li><li class="dropdown-subitem"><a href="/md/java/java8up/java-8-up-overview.html" class="nav-link">
  Java 8 以上版本特性体系
</a></li><li class="dropdown-subitem"><a href="/md/java/java8up/java9-11.html" class="nav-link">
  Java 8 升Java 11特性必读
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - JVM相关
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-classload.html" class="nav-link">
  Java 类加载机制
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-class.html" class="nav-link">
  Java 字节码和增强技术
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-struct.html" class="nav-link">
  JVM 内存结构详解
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-gc.html" class="nav-link">
  JVM 垃圾回收机制
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-debug-tools-linux.html" class="nav-link">
  Java 调试排错相关
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          数据库相关介绍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/db/info/mysql.html" class="nav-link">
  mysql
</a></li><li class="dropdown-subitem"><a href="/md/db/info/oracle.html" class="nav-link">
  oracle
</a></li><li class="dropdown-subitem"><a href="/md/db/info/h2.html" class="nav-link">
  h2
</a></li></ul></li><li class="dropdown-item"><h4>
          框架介绍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/db/frame/mybatis/mybatis-base-overview.html" class="nav-link">
  mybatis
</a></li><li class="dropdown-subitem"><a href="/md/db/frame/mp/mp-base-overview.html" class="nav-link">
  mybatis-plus
</a></li><li class="dropdown-subitem"><a href="/md/db/frame/jpa/jpa-base-overview.html" class="nav-link">
  jpa
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          redis
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/middleware/redis/redis-overview.html" class="nav-link">
  redis各大版本
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人记录" class="dropdown-title"><span class="title">个人记录</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人记录" class="mobile-dropdown-title"><span class="title">个人记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          2024
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/owner/2024/229-1.html" class="nav-link">
  vuepress打包报unsupported
</a></li><li class="dropdown-subitem"><a href="/md/owner/2024/229-2.html" class="nav-link">
  待定
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/xianglong123/cas-blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Java面向对象和基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/basic/java-basic-oop.html" class="nav-link">
  Java基础-面向对象
</a></li><li class="dropdown-subitem"><a href="/md/java/basic/java-basic-lan-basic.html" class="nav-link">
  Java基础-知识点
</a></li><li class="dropdown-subitem"><a href="/md/java/basic/java-basic-lan-sum.html" class="nav-link">
  Java 基础 - 图谱 &amp; Q/A
</a></li></ul></li><li class="dropdown-item"><h4>
          Java集合框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/collection/java-collection-all.html" class="nav-link">
  Java 集合框架详解
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - 并发框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-overview.html" class="nav-link">
  Java 并发知识体系
</a></li><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-theorty.html" class="nav-link">
  Java 并发理论基础
</a></li><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-thread-basic.html" class="nav-link">
  Java 并发线程基础
</a></li><li class="dropdown-subitem"><a href="/md/java/thread/java-thread-x-juc-overview.html" class="nav-link">
  J.U.C 知识体系与详解
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - IO框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/io/java-io-overview.html" class="nav-link">
  Java IO/NIO/AIO详解
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - 新版本特性
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/java8/java8.html" class="nav-link">
  Java 8 特性详解
</a></li><li class="dropdown-subitem"><a href="/md/java/java8up/java-8-up-overview.html" class="nav-link">
  Java 8 以上版本特性体系
</a></li><li class="dropdown-subitem"><a href="/md/java/java8up/java9-11.html" class="nav-link">
  Java 8 升Java 11特性必读
</a></li></ul></li><li class="dropdown-item"><h4>
          Java进阶 - JVM相关
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-classload.html" class="nav-link">
  Java 类加载机制
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-class.html" class="nav-link">
  Java 字节码和增强技术
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-struct.html" class="nav-link">
  JVM 内存结构详解
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-gc.html" class="nav-link">
  JVM 垃圾回收机制
</a></li><li class="dropdown-subitem"><a href="/md/java/jvm/java-jvm-debug-tools-linux.html" class="nav-link">
  Java 调试排错相关
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          数据库相关介绍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/db/info/mysql.html" class="nav-link">
  mysql
</a></li><li class="dropdown-subitem"><a href="/md/db/info/oracle.html" class="nav-link">
  oracle
</a></li><li class="dropdown-subitem"><a href="/md/db/info/h2.html" class="nav-link">
  h2
</a></li></ul></li><li class="dropdown-item"><h4>
          框架介绍
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/db/frame/mybatis/mybatis-base-overview.html" class="nav-link">
  mybatis
</a></li><li class="dropdown-subitem"><a href="/md/db/frame/mp/mp-base-overview.html" class="nav-link">
  mybatis-plus
</a></li><li class="dropdown-subitem"><a href="/md/db/frame/jpa/jpa-base-overview.html" class="nav-link">
  jpa
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          redis
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/middleware/redis/redis-overview.html" class="nav-link">
  redis各大版本
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人记录" class="dropdown-title"><span class="title">个人记录</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人记录" class="mobile-dropdown-title"><span class="title">个人记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          2024
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/md/owner/2024/229-1.html" class="nav-link">
  vuepress打包报unsupported
</a></li><li class="dropdown-subitem"><a href="/md/owner/2024/229-2.html" class="nav-link">
  待定
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/xianglong123/cas-blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java 基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/basic/java-basic-oop.html" class="sidebar-link">Java 基础 - 面向对象</a></li><li><a href="/md/java/basic/java-basic-lan-basic.html" class="sidebar-link">Java 基础 - 知识点</a></li><li><a href="/md/java/basic/java-basic-lan-sum.html" class="sidebar-link">Java 基础 - 图谱 &amp; Q/A</a></li><li><a href="/md/java/basic/java-basic-x-generic.html" class="sidebar-link">Java 基础 - 泛型机制详解</a></li><li><a href="/md/java/basic/java-basic-x-exception.html" class="sidebar-link">Java 基础 - 异常机制详解</a></li><li><a href="/md/java/basic/java-basic-x-reflection.html" class="sidebar-link">Java 基础 - 反射机制详解</a></li><li><a href="/md/java/advanced/java-advanced-spi.html" class="sidebar-link">Java常用机制 - SPI机制详解</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java 集合框架</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/collection/java-collection-all.html" class="sidebar-link">Collection 类关系图</a></li><li><a href="/md/java/collection/java-collection-ArrayList.html" class="sidebar-link">Collection - ArrayList 源码解析</a></li><li><a href="/md/java/collection/java-collection-LinkedList.html" class="sidebar-link">Collection - LinkedList源码解析</a></li><li><a href="/md/java/collection/java-collection-Queue&amp;Stack.html" class="sidebar-link">Collection - Stack &amp; Queue 源码解析</a></li><li><a href="/md/java/collection/java-collection-PriorityQueue.html" class="sidebar-link">Collection - PriorityQueue源码解析</a></li><li><a href="/md/java/collection/java-map-HashMap&amp;HashSet.html" class="sidebar-link">Map - HashSet &amp; HashMap 源码解析</a></li><li><a href="/md/java/collection/java-map-LinkedHashMap&amp;LinkedHashSet.html" class="sidebar-link">Map - LinkedHashSet&amp;Map源码解析</a></li><li><a href="/md/java/collection/java-map-TreeMap&amp;TreeSet.html" class="sidebar-link">Map - TreeSet &amp; TreeMap 源码解析</a></li><li><a href="/md/java/collection/java-map-WeakHashMap.html" class="sidebar-link">Map - WeakHashMap源码解析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java 多线程与并发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/thread/java-thread-x-overview.html" class="sidebar-link">♥Java并发知识体系详解♥</a></li><li><a href="/md/java/thread/java-thread-x-theorty.html" class="sidebar-link">Java 并发 - 理论基础</a></li><li><a href="/md/java/thread/java-thread-x-thread-basic.html" class="sidebar-link">Java 并发 - 线程基础</a></li><li><a href="/md/java/thread/java-thread-x-lock-all.html" class="sidebar-link">Java并发 - Java中所有的锁</a></li><li><a href="/md/java/thread/java-thread-x-key-synchronized.html" class="sidebar-link">关键字:synchronized详解</a></li><li><a href="/md/java/thread/java-thread-x-key-volatile.html" class="sidebar-link">关键字:volatile详解</a></li><li><a href="/md/java/thread/java-thread-x-key-final.html" class="sidebar-link">关键字:final详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-overview.html" class="sidebar-link">JUC - 类汇总和学习指南</a></li><li><a href="/md/java/thread/java-thread-x-juc-AtomicInteger.html" class="sidebar-link">JUC原子类CAS, Unsafe和原子类详解</a></li><li><a href="/md/java/thread/java-thread-x-lock-LockSupport.html" class="sidebar-link">JUC锁:LockSupport详解</a></li><li><a href="/md/java/thread/java-thread-x-lock-AbstractQueuedSynchronizer.html" class="sidebar-link">JUC锁:锁核心类AQS详解</a></li><li><a href="/md/java/thread/java-thread-x-lock-ReentrantLock.html" class="sidebar-link">JUC锁:ReentrantLock详解</a></li><li><a href="/md/java/thread/java-thread-x-lock-ReentrantReadWriteLock.html" class="sidebar-link">JUC锁:ReentrantReadWriteLock详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-collection-ConcurrentHashMap.html" class="sidebar-link">JUC集合:ConcurrentHashMap详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-collection-CopyOnWriteArrayList.html" class="sidebar-link">JUC集合:CopyOnWriteArrayList详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-collection-ConcurrentLinkedQueue.html" class="sidebar-link">JUC集合:ConcurrentLinkedQueue详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-collection-BlockingQueue.html" class="sidebar-link">JUC集合:BlockingQueue详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-executor-FutureTask.html" class="sidebar-link">JUC线程池:FutureTask详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-executor-ThreadPoolExecutor.html" class="sidebar-link">JUC线程池:ThreadPoolExecutor详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-executor-ScheduledThreadPoolExecutor.html" class="sidebar-link">JUC线程池:ScheduledThreadPoolExecutor详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-executor-ForkJoinPool.html" class="sidebar-link">JUC线程池:Fork/Join框架详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-tool-countdownlatch.html" aria-current="page" class="active sidebar-link">JUC工具类:CountDownLatch详解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/md/java/thread/java-thread-x-juc-tool-cyclicbarrier.html" class="sidebar-link">JUC工具类:CyclicBarrier详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-tool-semaphore.html" class="sidebar-link">JUC工具类:Semaphore详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-tool-phaser.html" class="sidebar-link">JUC工具类:Phaser详解</a></li><li><a href="/md/java/thread/java-thread-x-juc-tool-exchanger.html" class="sidebar-link">JUC工具类:Exchanger详解</a></li><li><a href="/md/java/thread/java-thread-x-threadlocal.html" class="sidebar-link">Java 并发 - ThreadLocal详解</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java IO/NIO/AIO</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/io/java-io-overview.html" class="sidebar-link">♥Java IO知识体系详解♥</a></li><li><a href="/md/java/io/java-io-basic-category.html" class="sidebar-link">Java IO - 分类(传输，操作)</a></li><li><a href="/md/java/io/java-io-basic-design-pattern.html" class="sidebar-link">Java IO - 设计模式(装饰者模式)</a></li><li><a href="/md/java/io/java-io-basic-code-inputstream.html" class="sidebar-link">Java IO - 源码:InputStream</a></li><li><a href="/md/java/io/java-io-basic-code-outputstream.html" class="sidebar-link">Java IO - 源码:OutputStream</a></li><li><a href="/md/java/io/java-io-basic-usage.html" class="sidebar-link">Java IO - 常见类使用</a></li><li><a href="/md/java/io/java-io-model.html" class="sidebar-link">IO 模型 - Unix IO 模型</a></li><li><a href="/md/java/io/java-io-bio.html" class="sidebar-link">Java IO - BIO 详解</a></li><li><a href="/md/java/io/java-io-nio.html" class="sidebar-link">Java NIO - 基础详解</a></li><li><a href="/md/java/io/java-io-nio-select-epoll.html" class="sidebar-link">Java NIO - IO多路复用详解</a></li><li><a href="/md/java/io/java-io-aio.html" class="sidebar-link">Java AIO - 异步IO详解</a></li><li><a href="/md/java/io/java-io-nio-netty.html" class="sidebar-link">Java N(A)IO - 框架:Netty</a></li><li><a href="/md/java/io/java-io-nio-zerocopy.html" class="sidebar-link">Java NIO - 零拷贝实现</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java8 特性详解</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/java8/java8.html" class="sidebar-link">♥Java8特性知识体系详解♥</a></li><li><a href="/md/java/java8/java8-stream.html" class="sidebar-link">Java 8 - 函数编程(lambda表达式)</a></li><li><a href="/md/java/java8/java8-optional.html" class="sidebar-link">Java 8 - Optional类深度解析</a></li><li><a href="/md/java/java8/java8-default.html" class="sidebar-link">Java 8 - 默认方法</a></li><li><a href="/md/java/java8/java8-type-anno.html" class="sidebar-link">Java 8 - 类型注解</a></li><li><a href="/md/java/java8/java8-anno-repeat.html" class="sidebar-link">Java 8 - 重复注解</a></li><li><a href="/md/java/java8/java8-type.html" class="sidebar-link">Java 8 - 类型推断优化</a></li><li><a href="/md/java/java8/java8-jre.html" class="sidebar-link">Java 8 - JRE精简</a></li><li><a href="/md/java/java8/java8-permgen.html" class="sidebar-link">Java 8 - 移除Permgen</a></li><li><a href="/md/java/java8/java8-stampedlock.html" class="sidebar-link">Java 8 - StampedLock</a></li><li><a href="/md/java/java8/java8-localdatetime.html" class="sidebar-link">Java 8 - LocalDate/LocalDateTime</a></li><li><a href="/md/java/java8/java8-javafx.html" class="sidebar-link">Java 8 - JavaFx 2.0</a></li><li><a href="/md/java/java8/java8-others.html" class="sidebar-link">Java 8 - 其它更新:字符串base64,...</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java8 以上特性概述</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/java8up/java-8-up-overview.html" class="sidebar-link">♥Java8+特性知识体系详解♥</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JVM相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/java/jvm/java-jvm-x-overview.html" class="sidebar-link">♥JVM相关知识体系详解♥</a></li><li><a href="/md/java/jvm/java-jvm-class.html" class="sidebar-link">JVM 基础 - 类字节码详解</a></li><li><a href="/md/java/jvm/java-jvm-class-enhancer.html" class="sidebar-link">JVM 基础 - 字节码的增强技术</a></li><li><a href="/md/java/jvm/java-jvm-classload.html" class="sidebar-link">JVM 基础 - Java 类加载机制</a></li><li><a href="/md/java/jvm/java-jvm-struct.html" class="sidebar-link">JVM 基础 - JVM 内存结构</a></li><li><a href="/md/java/jvm/java-jvm-x-introduce.html" class="sidebar-link">JVM 基础 - Java 内存模型引入</a></li><li><a href="/md/java/jvm/java-jvm-jmm.html" class="sidebar-link">JVM 基础 - Java 内存模型详解</a></li><li><a href="/md/java/jvm/java-jvm-gc.html" class="sidebar-link">GC - Java 垃圾回收基础知识</a></li><li><a href="/md/java/jvm/java-jvm-gc-g1.html" class="sidebar-link">GC - Java 垃圾回收器之G1详解</a></li><li><a href="/md/java/jvm/java-jvm-gc-zgc.html" class="sidebar-link">GC - Java 垃圾回收器之ZGC详解</a></li><li><a href="/md/java/jvm/java-jvm-cms-gc.html" class="sidebar-link">GC - Java 垃圾回收器之CMS GC问题分析与解决</a></li><li><a href="/md/java/jvm/java-jvm-param.html" class="sidebar-link">调试排错 - JVM 调优参数</a></li><li><a href="/md/java/jvm/java-jvm-oom.html" class="sidebar-link">调试排错 - Java 内存分析之堆内存和MetaSpace内存</a></li><li><a href="/md/java/jvm/java-jvm-oom-offheap.html" class="sidebar-link">调试排错 - Java 内存分析之堆外内存</a></li><li><a href="/md/java/jvm/java-jvm-thread-dump.html" class="sidebar-link">调试排错 - Java 线程分析之线程Dump分析</a></li><li><a href="/md/java/jvm/java-jvm-debug-tools-linux.html" class="sidebar-link">调试排错 - Java 问题排查之Linux命令</a></li><li><a href="/md/java/jvm/java-jvm-debug-tools-list.html" class="sidebar-link">调试排错 - Java 问题排查之工具单</a></li><li><a href="/md/java/jvm/java-jvm-oom-tool.html" class="sidebar-link">调试排错 - Java 问题排查之JVM可视化工具</a></li><li><a href="/md/java/jvm/java-jvm-agent-arthas.html" class="sidebar-link">调试排错 - Java 问题排查之应用在线调试Arthas</a></li><li><a href="/md/java/jvm/java-jvm-debug-idea.html" class="sidebar-link">调试排错 - Java 问题排查之使用IDEA本地调试和远程调试</a></li><li><a href="/md/java/jvm/java-jvm-agent-usage.html" class="sidebar-link">调试排错 - Java动态调试技术原理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="juc工具类-countdownlatch详解"><a href="#juc工具类-countdownlatch详解" class="header-anchor">#</a> JUC工具类:CountDownLatch详解</h1> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>CountDownLatch底层也是由AQS，用来同步一个或多个任务的常用并发工具类，强制它们等待由其他任务执行的一组操作完成。 @123</p></div> <ul><li>JUC工具类: CountDownLatch详解
<ul><li>带着BAT大厂的面试问题去理解</li> <li>CountDownLatch介绍</li> <li>CountDownLatch源码分析
<ul><li>类的继承关系</li> <li>类的内部类</li> <li>类的属性</li> <li>类的构造函数</li> <li>核心函数 - await函数</li> <li>核心函数 - countDown函数</li></ul></li> <li>CountDownLatch示例</li> <li>更深入理解
<ul><li>写道面试题</li> <li>使用wait和notify实现</li> <li>CountDownLatch实现</li></ul></li> <li>参考文章</li></ul></li></ul> <h3 id="带着bat大厂的面试问题去理解"><a href="#带着bat大厂的面试问题去理解" class="header-anchor">#</a> # 带着BAT大厂的面试问题去理解</h3> <blockquote><p>提示</p></blockquote> <blockquote><p>请带着这些问题继续后文，会很大程度上帮助你更好的理解相关知识点。@pdai</p></blockquote> <ul><li>什么是CountDownLatch?</li> <li>CountDownLatch底层实现原理?</li> <li>CountDownLatch一次可以唤醒几个任务? 多个</li> <li>CountDownLatch有哪些主要方法? await(),countDown()</li> <li>CountDownLatch适用于什么场景?</li> <li>写道题：实现一个容器，提供两个方法，add，size 写两个线程，线程1添加10个元素到容器中，线程2实现监控元素的个数，当个数到5个时，线程2给出提示并结束? 使用CountDownLatch 代替wait notify 好处。</li></ul> <h3 id="countdownlatch介绍"><a href="#countdownlatch介绍" class="header-anchor">#</a> # CountDownLatch介绍</h3> <blockquote><p>从源码可知，其底层是由AQS提供支持，所以其数据结构可以参考AQS的数据结构，而AQS的数据结构核心就是两个虚拟队列: 同步队列sync queue 和条件队列condition queue，不同的条件会有不同的条件队列。CountDownLatch典型的用法是将一个程序分为n个互相独立的可解决任务，并创建值为n的CountDownLatch。当每一个任务完成时，都会在这个锁存器上调用countDown，等待问题被解决的任务调用这个锁存器的await，将他们自己拦住，直至锁存器计数结束。</p></blockquote> <h3 id="countdownlatch源码分析"><a href="#countdownlatch源码分析" class="header-anchor">#</a> # CountDownLatch源码分析</h3> <h3 id="类的继承关系"><a href="#类的继承关系" class="header-anchor">#</a> # 类的继承关系</h3> <blockquote><p>CountDownLatch没有显示继承哪个父类或者实现哪个父接口, 它底层是AQS是通过内部类Sync来实现的。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class CountDownLatch {}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="类的内部类"><a href="#类的内部类" class="header-anchor">#</a> # 类的内部类</h3> <blockquote><p>CountDownLatch类存在一个内部类Sync，继承自AbstractQueuedSynchronizer，其源代码如下。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>private static final class Sync extends AbstractQueuedSynchronizer {
    // 版本号
    private static final long serialVersionUID = 4982264981922014374L;

    // 构造器
    Sync(int count) {
        setState(count);
    }

    // 返回当前计数
    int getCount() {
        return getState();
    }

    // 试图在共享模式下获取对象状态
    protected int tryAcquireShared(int acquires) {
        return (getState() == 0) ? 1 : -1;
    }

    // 试图设置状态来反映共享模式下的一个释放
    protected boolean tryReleaseShared(int releases) {
        // Decrement count; signal when transition to zero
        // 无限循环
        for (;;) {
            // 获取状态
            int c = getState();
            if (c == 0) // 没有被线程占有
                return false;
            // 下一个状态
            int nextc = c-1;
            if (compareAndSetState(c, nextc)) // 比较并且设置成功
                return nextc == 0;
        }
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><blockquote><p>说明: 对CountDownLatch方法的调用会转发到对Sync或AQS的方法的调用，所以，AQS对CountDownLatch提供支持。</p></blockquote> <h3 id="类的属性"><a href="#类的属性" class="header-anchor">#</a> # 类的属性</h3> <blockquote><p>可以看到CountDownLatch类的内部只有一个Sync类型的属性:</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>public class CountDownLatch {
    // 同步队列
    private final Sync sync;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="类的构造函数"><a href="#类的构造函数" class="header-anchor">#</a> # 类的构造函数</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>public CountDownLatch(int count) {
    if (count &lt; 0) throw new IllegalArgumentException(&quot;count &lt; 0&quot;);
    // 初始化状态数
    this.sync = new Sync(count);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>说明: 该构造函数可以构造一个用给定计数初始化的CountDownLatch，并且构造函数内完成了sync的初始化，并设置了状态数。</p></blockquote> <h3 id="核心函数-await函数"><a href="#核心函数-await函数" class="header-anchor">#</a> # 核心函数 - await函数</h3> <blockquote><p>此函数将会使当前线程在锁存器倒计数至零之前一直等待，除非线程被中断。其源码如下</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>public void await() throws InterruptedException {
    // 转发到sync对象上
    sync.acquireSharedInterruptibly(1);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>说明: 由源码可知，对CountDownLatch对象的await的调用会转发为对Sync的acquireSharedInterruptibly(从AQS继承的方法)方法的调用。</p></blockquote> <ul><li>acquireSharedInterruptibly源码如下:</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>public final void acquireSharedInterruptibly(int arg)
        throws InterruptedException {
    if (Thread.interrupted())
        throw new InterruptedException();
    if (tryAcquireShared(arg) &lt; 0)
        doAcquireSharedInterruptibly(arg);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>说明: 从源码中可知，acquireSharedInterruptibly又调用了CountDownLatch的内部类Sync的tryAcquireShared和AQS的doAcquireSharedInterruptibly函数。</p></blockquote> <ul><li>tryAcquireShared函数的源码如下:</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>protected int tryAcquireShared(int acquires) {
    return (getState() == 0) ? 1 : -1;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>说明: 该函数只是简单的判断AQS的state是否为0，为0则返回1，不为0则返回-1。</p></blockquote> <ul><li>doAcquireSharedInterruptibly函数的源码如下:</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>private void doAcquireSharedInterruptibly(int arg) throws InterruptedException {
    // 添加节点至等待队列
    final Node node = addWaiter(Node.SHARED);
    boolean failed = true;
    try {
        for (;;) { // 无限循环
            // 获取node的前驱节点
            final Node p = node.predecessor();
            if (p == head) { // 前驱节点为头节点
                // 试图在共享模式下获取对象状态
                int r = tryAcquireShared(arg);
                if (r &gt;= 0) { // 获取成功
                    // 设置头节点并进行繁殖
                    setHeadAndPropagate(node, r);
                    // 设置节点next域
                    p.next = null; // help GC
                    failed = false;
                    return;
                }
            }
            if (shouldParkAfterFailedAcquire(p, node) &amp;&amp;
                parkAndCheckInterrupt()) // 在获取失败后是否需要禁止线程并且进行中断检查
                // 抛出异常
                throw new InterruptedException();
        }
    } finally {
        if (failed)
            cancelAcquire(node);
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><blockquote><p>说明: 在AQS的doAcquireSharedInterruptibly中可能会再次调用CountDownLatch的内部类Sync的tryAcquireShared方法和AQS的setHeadAndPropagate方法。</p></blockquote> <ul><li>setHeadAndPropagate方法源码如下。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>private void setHeadAndPropagate(Node node, int propagate) {
    // 获取头节点
    Node h = head; // Record old head for check below
    // 设置头节点
    setHead(node);
    /*
        * Try to signal next queued node if:
        *   Propagation was indicated by caller,
        *     or was recorded (as h.waitStatus either before
        *     or after setHead) by a previous operation
        *     (note: this uses sign-check of waitStatus because
        *      PROPAGATE status may transition to SIGNAL.)
        * and
        *   The next node is waiting in shared mode,
        *     or we don't know, because it appears null
        *
        * The conservatism in both of these checks may cause
        * unnecessary wake-ups, but only when there are multiple
        * racing acquires/releases, so most need signals now or soon
        * anyway.
        */
    // 进行判断
    if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 ||
        (h = head) == null || h.waitStatus &lt; 0) {
        // 获取节点的后继
        Node s = node.next;
        if (s == null || s.isShared()) // 后继为空或者为共享模式
            // 以共享模式进行释放
            doReleaseShared();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><blockquote><p>说明: 该方法设置头节点并且释放头节点后面的满足条件的结点，该方法中可能会调用到AQS的doReleaseShared方法，其源码如下。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>private void doReleaseShared() {
    /*
        * Ensure that a release propagates, even if there are other
        * in-progress acquires/releases.  This proceeds in the usual
        * way of trying to unparkSuccessor of head if it needs
        * signal. But if it does not, status is set to PROPAGATE to
        * ensure that upon release, propagation continues.
        * Additionally, we must loop in case a new node is added
        * while we are doing this. Also, unlike other uses of
        * unparkSuccessor, we need to know if CAS to reset status
        * fails, if so rechecking.
        */
    // 无限循环
    for (;;) {
        // 保存头节点
        Node h = head;
        if (h != null &amp;&amp; h != tail) { // 头节点不为空并且头节点不为尾结点
            // 获取头节点的等待状态
            int ws = h.waitStatus; 
            if (ws == Node.SIGNAL) { // 状态为SIGNAL
                if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) // 不成功就继续
                    continue;            // loop to recheck cases
                // 释放后继结点
                unparkSuccessor(h);
            }
            else if (ws == 0 &amp;&amp;
                        !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) // 状态为0并且不成功，继续
                continue;                // loop on failed CAS
        }
        if (h == head) // 若头节点改变，继续循环  
            break;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><blockquote><p>说明: 该方法在共享模式下释放，具体的流程再之后会通过一个示例给出。</p></blockquote> <blockquote><p>所以，对CountDownLatch的await调用大致会有如下的调用链。</p></blockquote> <blockquote><p><img src="data:image/png;base64,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" alt=""></p></blockquote> <blockquote><p>说明: 上图给出了可能会调用到的主要方法，并非一定会调用到，之后，会通过一个示例给出详细的分析。</p></blockquote> <h3 id="核心函数-countdown函数"><a href="#核心函数-countdown函数" class="header-anchor">#</a> # 核心函数 - countDown函数</h3> <blockquote><p>此函数将递减锁存器的计数，如果计数到达零，则释放所有等待的线程</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>public void countDown() {
    sync.releaseShared(1);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>说明: 对countDown的调用转换为对Sync对象的releaseShared(从AQS继承而来)方法的调用。</p></blockquote> <ul><li>releaseShared源码如下</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>public final boolean releaseShared(int arg) {
    if (tryReleaseShared(arg)) {
        doReleaseShared();
        return true;
    }
    return false;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>说明: 此函数会以共享模式释放对象，并且在函数中会调用到CountDownLatch的tryReleaseShared函数，并且可能会调用AQS的doReleaseShared函数。</p></blockquote> <ul><li>tryReleaseShared源码如下</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>protected boolean tryReleaseShared(int releases) {
    // Decrement count; signal when transition to zero
    // 无限循环
    for (;;) {
        // 获取状态
        int c = getState();
        if (c == 0) // 没有被线程占有
            return false;
        // 下一个状态
        int nextc = c-1;
        if (compareAndSetState(c, nextc)) // 比较并且设置成功
            return nextc == 0;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>说明: 此函数会试图设置状态来反映共享模式下的一个释放。具体的流程在下面的示例中会进行分析。</p></blockquote> <ul><li>AQS的doReleaseShared的源码如下</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>private void doReleaseShared() {
    /*
        * Ensure that a release propagates, even if there are other
        * in-progress acquires/releases.  This proceeds in the usual
        * way of trying to unparkSuccessor of head if it needs
        * signal. But if it does not, status is set to PROPAGATE to
        * ensure that upon release, propagation continues.
        * Additionally, we must loop in case a new node is added
        * while we are doing this. Also, unlike other uses of
        * unparkSuccessor, we need to know if CAS to reset status
        * fails, if so rechecking.
        */
    // 无限循环
    for (;;) {
        // 保存头节点
        Node h = head;
        if (h != null &amp;&amp; h != tail) { // 头节点不为空并且头节点不为尾结点
            // 获取头节点的等待状态
            int ws = h.waitStatus; 
            if (ws == Node.SIGNAL) { // 状态为SIGNAL
                if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) // 不成功就继续
                    continue;            // loop to recheck cases
                // 释放后继结点
                unparkSuccessor(h);
            }
            else if (ws == 0 &amp;&amp;
                        !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) // 状态为0并且不成功，继续
                continue;                // loop on failed CAS
        }
        if (h == head) // 若头节点改变，继续循环  
            break;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><blockquote><p>说明: 此函数在共享模式下释放资源。</p></blockquote> <blockquote><p>所以，对CountDownLatch的countDown调用大致会有如下的调用链。</p></blockquote> <blockquote><p><img src="data:image/png;base64,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" alt=""></p></blockquote> <blockquote><p>说明: 上图给出了可能会调用到的主要方法，并非一定会调用到，之后，会通过一个示例给出详细的分析。</p></blockquote> <h3 id="countdownlatch示例"><a href="#countdownlatch示例" class="header-anchor">#</a> # CountDownLatch示例</h3> <blockquote><p>下面给出了一个使用CountDownLatch的示例。</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.concurrent.CountDownLatch;

class MyThread extends Thread {
    private CountDownLatch countDownLatch;

    public MyThread(String name, CountDownLatch countDownLatch) {
        super(name);
        this.countDownLatch = countDownLatch;
    }

    public void run() {
        System.out.println(Thread.currentThread().getName() + &quot; doing something&quot;);
        try {
            Thread.sleep(1000);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        System.out.println(Thread.currentThread().getName() + &quot; finish&quot;);
        countDownLatch.countDown();
    }
}

public class CountDownLatchDemo {
    public static void main(String[] args) {
        CountDownLatch countDownLatch = new CountDownLatch(2);
        MyThread t1 = new MyThread(&quot;t1&quot;, countDownLatch);
        MyThread t2 = new MyThread(&quot;t2&quot;, countDownLatch);
        tstart();
        tstart();
        System.out.println(&quot;Waiting for t1 thread and t2 thread to finish&quot;);
        try {
            countDownLatch.await();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }            
        System.out.println(Thread.currentThread().getName() + &quot; continue&quot;);        
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><blockquote><p>运行结果(某一次):</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>Waiting for t1 thread and t2 thread to finish
t1 doing something
t2 doing something
t1 finish
t2 finish
main continue
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>说明: 本程序首先计数器初始化为2。根据结果，可能会存在如下的一种时序图。</p></blockquote> <blockquote><p><img src="data:image/png;base64,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" alt=""></p></blockquote> <blockquote><p>说明: 首先main线程会调用await操作，此时main线程会被阻塞，等待被唤醒，之后t1线程执行了countDown操作，最后，t2线程执行了countDown操作，此时main线程就被唤醒了，可以继续运行。下面，进行详细分析。</p></blockquote> <ul><li>main线程执行countDownLatch.await操作，主要调用的函数如下。</li></ul> <blockquote><p><img src="/assets/img/java-thread-x-countdownlatch-4.e33298c3.png" alt=""></p></blockquote> <blockquote><p>说明: 在最后，main线程就被park了，即禁止运行了。此时Sync queue(同步队列)中有两个节点，AQS的state为2，包含main线程的结点的nextWaiter指向SHARED结点。</p></blockquote> <ul><li>t1线程执行countDownLatch.countDown操作，主要调用的函数如下。</li></ul> <blockquote><p><img src="data:image/png;base64,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" alt=""></p></blockquote> <blockquote><p>说明: 此时，Sync queue队列里的结点个数未发生变化，但是此时，AQS的state已经变为1了。</p></blockquote> <ul><li>t2线程执行countDownLatch.countDown操作，主要调用的函数如下。</li></ul> <blockquote><p><img src="data:image/png;base64,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" alt=""></p></blockquote> <blockquote><p>说明: 经过调用后，AQS的state为0，并且此时，main线程会被unpark，可以继续运行。当main线程获取cpu资源后，继续运行。</p></blockquote> <ul><li>main线程获取cpu资源，继续运行，由于main线程是在parkAndCheckInterrupt函数中被禁止的，所以此时，继续在parkAndCheckInterrupt函数运行。</li></ul> <blockquote><p><img src="data:image/png;base64,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" alt=""></p></blockquote> <blockquote><p>说明: main线程恢复，继续在parkAndCheckInterrupt函数中运行，之后又会回到最终达到的状态为AQS的state为0，并且head与tail指向同一个结点，该节点的额nextWaiter域还是指向SHARED结点。</p></blockquote> <h3 id="更深入理解"><a href="#更深入理解" class="header-anchor">#</a> # 更深入理解</h3> <h3 id="写道面试题"><a href="#写道面试题" class="header-anchor">#</a> # 写道面试题</h3> <blockquote><blockquote><p>实现一个容器，提供两个方法，add，size 写两个线程，线程1添加10个元素到容器中，线程2实现监控元素的个数，当个数到5个时，线程2给出提示并结束.</p></blockquote></blockquote> <h3 id="使用wait和notify实现"><a href="#使用wait和notify实现" class="header-anchor">#</a> # 使用wait和notify实现</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.ArrayList;
import java.util.List;

/**
 *  必须先让t2先进行启动 使用wait 和 notify 进行相互通讯，wait会释放锁，notify不会释放锁
 */
public class T2 {

 volatile   List list = new ArrayList();

    public void add (int i){
        list.add(i);
    }

    public int getSize(){
        return list.size();
    }

    public static void main(String[] args) {

        T2 t2 = new T2();

        Object lock = new Object();

        new Thread(() -&gt; {
            synchronized(lock){
                System.out.println(&quot;t2 启动&quot;);
                if(tgetSize() != 5){
                    try {
                        /**会释放锁*/
                        lock.wait();
                        System.out.println(&quot;t2 结束&quot;);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
                lock.notify();
            }
        },&quot;t2&quot;).start();

        new Thread(() -&gt; {
           synchronized (lock){
               System.out.println(&quot;t1 启动&quot;);
               for (int i=0;i&lt;9;i++){
                   tadd(i);
                   System.out.println(&quot;add&quot;+i);
                   if(tgetSize() == 5){
                       /**不会释放锁*/
                       lock.notify();
                       try {
                           lock.wait();
                       } catch (InterruptedException e) {
                           e.printStackTrace();
                       }
                   }
               }
           }
        }).start();
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><blockquote><p>输出：</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>t2 启动
t1 启动
add0
add1
add2
add3
add4
t2 结束
add5
add6
add7
add8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="countdownlatch实现"><a href="#countdownlatch实现" class="header-anchor">#</a> # CountDownLatch实现</h3> <blockquote><p>说出使用CountDownLatch 代替wait notify 好处?</p></blockquote> <div class="language- line-numbers-mode"><pre class="language-text"><code>import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.CountDownLatch;

/**
 * 使用CountDownLatch 代替wait notify 好处是通讯方式简单，不涉及锁定  Count 值为0时当前线程继续执行，
 */
public class T3 {

   volatile List list = new ArrayList();

    public void add(int i){
        list.add(i);
    }

    public int getSize(){
        return list.size();
    }

    public static void main(String[] args) {
        T3 t = new T3();
        CountDownLatch countDownLatch = new CountDownLatch(1);

        new Thread(() -&gt; {
            System.out.println(&quot;t2 start&quot;);
           if(t.getSize() != 5){
               try {
                   countDownLatch.await();
                   System.out.println(&quot;t2 end&quot;);
               } catch (InterruptedException e) {
                   e.printStackTrace();
               }
           }
        },&quot;t2&quot;).start();

        new Thread(()-&gt;{
            System.out.println(&quot;t1 start&quot;);
           for (int i = 0;i&lt;9;i++){
               t.add(i);
               System.out.println(&quot;add&quot;+ i);
               if(t.getSize() == 5){
                   System.out.println(&quot;countdown is open&quot;);
                   countDownLatch.countDown();
               }
           }
            System.out.println(&quot;t1 end&quot;);
        },&quot;t1&quot;).start();
    }

}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h3 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> # 参考文章</h3> <ul><li>文章主要参考自leesf的https://www.cnblogs.com/leesf456/p/5406191.html，在此基础上做了增改。</li> <li>https://www.jianshu.com/p/40336ef1f5fe</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/13/2023, 11:19:20 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/md/java/thread/java-thread-x-juc-executor-ForkJoinPool.html" class="prev">
        JUC线程池:Fork/Join框架详解
      </a></span> <span class="next"><a href="/md/java/thread/java-thread-x-juc-tool-cyclicbarrier.html">
        JUC工具类:CyclicBarrier详解
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:290px;display:none;" data-v-5775ee02>
      欢迎来到我的博客
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="260px" height="320" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><canvas id="vuepress-canvas-cursor"></canvas><!----><div class="RibbonAnimation"></div><!----><div class="Sakura" data-v-248d85d6><canvas id="canvas_sakura" style="z-index:2;" data-v-248d85d6></canvas></div></div></div>
    <script src="/assets/js/app.0d6df2e4.js" defer></script><script src="/assets/js/3.2c60df78.js" defer></script><script src="/assets/js/17.dbfc7bb2.js" defer></script>
  </body>
</html>
